<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="关于netty" /><meta name="author" content="Narule" /><meta property="og:locale" content="en_US" /><meta name="description" content="关于netty netty 是一个非阻塞IO框架，用于Java网络应用开发，特点是异步处理，并发处理能力，netty里面包含有reactor框架的实现，是一个非常高级的框架体系。 netty特性 netty 处理快，更少的资源需求，响应快，可以作为高并发场景服务器的一个选择 reactor 个人理解是 react：响应式， or ：对象，就是响应式框架，netty 就是运用reactor 的核心设计思想编写的高性能高并发网络请求处理器框架。 以下来自维基百科，自由的百科全书 跳到导航跳到搜索 注意：本条目主题可能尚无中文译名，因而使用原文或其拉丁字母转写作为标题。如果您在可靠来源中找到本主题的中文名称，请勇于将其移动至中文标题。（2019年2月）   开发者 Netty项目社区 稳定版本 4.1.31.Final[1]（2018年10月30日，2年前） 预览版本 5.0.0.Alpha3（2016年1月14日，5年前） 源代码库 github.com/netty/netty 编程语言 Java 类型 Enterprise Integration Patterns Message Oriented Middleware 许可协议 Apache许可证 2.0 网站 netty.io Netty是一个非阻塞I/O客户端-服务器框架，主要用于开发Java网络应用程序，如协议服务器和客户端。异步事件驱动的网络应用程序框架和工具用于简化网络编程，例如TCP和UDP套接字服务器。[2]Netty包括了反应器编程模式的实现。Netty最初由JBoss开发，现在由Netty项目社区开发和维护。 除了作为异步网络应用程序框架，Netty还包括了对HTTP、HTTP2、DNS及其他协议的支持，涵盖了在Servlet容器内运行的能力、对WebSockets的支持、与Google Protocol Buffers的集成、对SSL/TLS的支持以及对用于SPDY协议和消息压缩的支持。自2004年以来，Netty一直在被积极开发。[3] 从版本4.0.0开始，Netty在支持NIO和阻塞Java套接字的同时，还支持使用NIO.2作为后端。 用netty写一个简单非阻塞请求响应服务器 简单示意代码 服务端 服务器 HttpServer 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 package net.narule.jnetty.httpdemo; import io.netty.bootstrap.ServerBootstrap; import io.netty.channel.ChannelFuture; import io.netty.channel.EventLoopGroup; import io.netty.channel.nio.NioEventLoopGroup; import io.netty.channel.socket.nio.NioServerSocketChannel; import io.netty.handler.logging.LogLevel; import io.netty.handler.logging.LoggingHandler; import java.net.InetSocketAddress; /** * netty server */ public class HttpServer { int port ; public HttpServer(int port){ this.port = port; } public void start() throws Exception{ ServerBootstrap bootstrap = new ServerBootstrap(); // 事件监听相关对象配置 netty 循环监听是否有新事件 // 如果有 马上将事件交给处理器，处理器层层循环处理，会循环到自定义消息解析器 HttpRequestHandler EventLoopGroup boss = new NioEventLoopGroup(); EventLoopGroup work = new NioEventLoopGroup(); bootstrap.group(boss,work) .handler(new LoggingHandler(LogLevel.DEBUG)) .channel(NioServerSocketChannel.class) .childHandler(new HttpServerInitializer()); ChannelFuture f = bootstrap.bind(new InetSocketAddress(port)).sync(); System.out.println(&quot;server start... port : &quot; + port); f.channel().closeFuture().sync(); } } 请求处理器初始化 HttpServerInitializer initChannel 处理器配置。可以配置多个 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 package net.narule.jnetty.httpdemo; import io.netty.channel.ChannelInitializer; import io.netty.channel.ChannelPipeline; import io.netty.channel.socket.SocketChannel; import io.netty.handler.codec.http.HttpObjectAggregator; import io.netty.handler.codec.http.HttpServerCodec; public class HttpServerInitializer extends ChannelInitializer&lt;SocketChannel&gt; { @Override protected void initChannel(SocketChannel ch) throws Exception { ChannelPipeline pipeline = ch.pipeline(); // http 编解码 pipeline.addLast(new HttpServerCodec()); // http 消息聚合器 512*1024为接收的最大contentlength pipeline.addLast(&quot;httpAggregator&quot;,new HttpObjectAggregator(512*1024)); // 请求处理器 pipeline.addLast(new HttpRequestHandler()); } } 消息处理器 HttpRequestHandler 重写channelRead0 方法处理请求的消息并返回 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 package net.narule.jnetty.httpdemo; import java.util.Date; import java.util.HashMap; import java.util.Map; import java.util.Set; import io.netty.buffer.Unpooled; import io.netty.channel.ChannelFutureListener; import io.netty.channel.ChannelHandlerContext; import io.netty.channel.SimpleChannelInboundHandler; import io.netty.handler.codec.http.DefaultFullHttpResponse; import io.netty.handler.codec.http.FullHttpRequest; import io.netty.handler.codec.http.FullHttpResponse; import io.netty.handler.codec.http.HttpHeaderNames; import io.netty.handler.codec.http.HttpResponseStatus; import io.netty.handler.codec.http.HttpVersion; import io.netty.util.CharsetUtil; public class HttpRequestHandler extends SimpleChannelInboundHandler&lt;FullHttpRequest&gt; { @Override public void channelReadComplete(ChannelHandlerContext ctx) { ctx.flush(); } @Override protected void channelRead0(ChannelHandlerContext ctx, FullHttpRequest req) throws Exception { // 处理数据 Date date = new Date(System.currentTimeMillis()); String uri = req.uri(); Map&lt;String,String&gt; data = new HashMap&lt;&gt;(); String protocal = req.protocolVersion().text(); //获取HTTP协议版本 String content = req.content().toString(CharsetUtil.UTF_8); //获取HTTP协议版本 System.out.println(&quot;request uri:&quot; + uri); System.out.println(&quot;request content:&quot; + content); boolean match = false; if(uri.contains(&quot;J&quot;)) { match = true; } data.put(&quot;match&quot;, String.valueOf(match)); data.put(&quot;protocal&quot;, protocal); data.put(&quot;uri&quot;, uri); data.put(&quot;time&quot;, date.toString()); data.put(&quot;content&quot;, content); System.getProperty(&quot;HOST&quot;); String responsedata = &quot;{&quot;; Set&lt;String&gt; keySet = data.keySet(); int size = data.size(); for (String key : keySet) { size --; responsedata = responsedata + &quot;\&quot;&quot; + key + &quot;\&quot;:&quot; + &quot;\&quot;&quot; + data.get(key) + (size == 0? &quot;\&quot;}&quot; : &quot;\&quot;,&quot;); } // 创建http响应 FullHttpResponse response = new DefaultFullHttpResponse( HttpVersion.HTTP_1_1, HttpResponseStatus.OK, Unpooled.copiedBuffer(responsedata, CharsetUtil.UTF_8)); // 设置头信息 response.headers().set(HttpHeaderNames.CONTENT_TYPE, &quot;application/json; charset=UTF-8&quot;); // 将处理后的数据 write到客户端、 ctx.writeAndFlush(response).addListener(ChannelFutureListener.CLOSE); } } 启动 main方法启动服务 1 2 3 4 public static void main(String[] args) throws Exception{ HttpServer server = new HttpServer(80);// 80为启动端口 server.start(); } 1 server start... port : 80 客户端测试 浏览器发送请求 直接url栏输入get请求： 1 http://localhost/test?name=J&amp;time=-1 返回结果 1 2 3 4 5 6 7 { &quot;match&quot;:&quot;true&quot;, &quot;time&quot;:&quot;Sun Jul 11 21:52:22 CST 2021&quot;, &quot;protocal&quot;:&quot;HTTP/1.1&quot;, &quot;uri&quot;:&quot;/test?name=J&amp;time=-1&quot;, &quot;content&quot;:&quot;&quot; } 发送请求 1 http://localhost/test?name=nos&amp;time=-1 返回结果 1 2 3 4 5 6 7 { &quot;match&quot;:&quot;false&quot;, &quot;time&quot;:&quot;Sun Jul 11 21:52:22 CST 2021&quot;, &quot;protocal&quot;:&quot;HTTP/1.1&quot;, &quot;uri&quot;:&quot;/test?name=nos&amp;time=-1&quot;, &quot;content&quot;:&quot;&quot; }" /><meta property="og:description" content="关于netty netty 是一个非阻塞IO框架，用于Java网络应用开发，特点是异步处理，并发处理能力，netty里面包含有reactor框架的实现，是一个非常高级的框架体系。 netty特性 netty 处理快，更少的资源需求，响应快，可以作为高并发场景服务器的一个选择 reactor 个人理解是 react：响应式， or ：对象，就是响应式框架，netty 就是运用reactor 的核心设计思想编写的高性能高并发网络请求处理器框架。 以下来自维基百科，自由的百科全书 跳到导航跳到搜索 注意：本条目主题可能尚无中文译名，因而使用原文或其拉丁字母转写作为标题。如果您在可靠来源中找到本主题的中文名称，请勇于将其移动至中文标题。（2019年2月）   开发者 Netty项目社区 稳定版本 4.1.31.Final[1]（2018年10月30日，2年前） 预览版本 5.0.0.Alpha3（2016年1月14日，5年前） 源代码库 github.com/netty/netty 编程语言 Java 类型 Enterprise Integration Patterns Message Oriented Middleware 许可协议 Apache许可证 2.0 网站 netty.io Netty是一个非阻塞I/O客户端-服务器框架，主要用于开发Java网络应用程序，如协议服务器和客户端。异步事件驱动的网络应用程序框架和工具用于简化网络编程，例如TCP和UDP套接字服务器。[2]Netty包括了反应器编程模式的实现。Netty最初由JBoss开发，现在由Netty项目社区开发和维护。 除了作为异步网络应用程序框架，Netty还包括了对HTTP、HTTP2、DNS及其他协议的支持，涵盖了在Servlet容器内运行的能力、对WebSockets的支持、与Google Protocol Buffers的集成、对SSL/TLS的支持以及对用于SPDY协议和消息压缩的支持。自2004年以来，Netty一直在被积极开发。[3] 从版本4.0.0开始，Netty在支持NIO和阻塞Java套接字的同时，还支持使用NIO.2作为后端。 用netty写一个简单非阻塞请求响应服务器 简单示意代码 服务端 服务器 HttpServer 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 package net.narule.jnetty.httpdemo; import io.netty.bootstrap.ServerBootstrap; import io.netty.channel.ChannelFuture; import io.netty.channel.EventLoopGroup; import io.netty.channel.nio.NioEventLoopGroup; import io.netty.channel.socket.nio.NioServerSocketChannel; import io.netty.handler.logging.LogLevel; import io.netty.handler.logging.LoggingHandler; import java.net.InetSocketAddress; /** * netty server */ public class HttpServer { int port ; public HttpServer(int port){ this.port = port; } public void start() throws Exception{ ServerBootstrap bootstrap = new ServerBootstrap(); // 事件监听相关对象配置 netty 循环监听是否有新事件 // 如果有 马上将事件交给处理器，处理器层层循环处理，会循环到自定义消息解析器 HttpRequestHandler EventLoopGroup boss = new NioEventLoopGroup(); EventLoopGroup work = new NioEventLoopGroup(); bootstrap.group(boss,work) .handler(new LoggingHandler(LogLevel.DEBUG)) .channel(NioServerSocketChannel.class) .childHandler(new HttpServerInitializer()); ChannelFuture f = bootstrap.bind(new InetSocketAddress(port)).sync(); System.out.println(&quot;server start... port : &quot; + port); f.channel().closeFuture().sync(); } } 请求处理器初始化 HttpServerInitializer initChannel 处理器配置。可以配置多个 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 package net.narule.jnetty.httpdemo; import io.netty.channel.ChannelInitializer; import io.netty.channel.ChannelPipeline; import io.netty.channel.socket.SocketChannel; import io.netty.handler.codec.http.HttpObjectAggregator; import io.netty.handler.codec.http.HttpServerCodec; public class HttpServerInitializer extends ChannelInitializer&lt;SocketChannel&gt; { @Override protected void initChannel(SocketChannel ch) throws Exception { ChannelPipeline pipeline = ch.pipeline(); // http 编解码 pipeline.addLast(new HttpServerCodec()); // http 消息聚合器 512*1024为接收的最大contentlength pipeline.addLast(&quot;httpAggregator&quot;,new HttpObjectAggregator(512*1024)); // 请求处理器 pipeline.addLast(new HttpRequestHandler()); } } 消息处理器 HttpRequestHandler 重写channelRead0 方法处理请求的消息并返回 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 package net.narule.jnetty.httpdemo; import java.util.Date; import java.util.HashMap; import java.util.Map; import java.util.Set; import io.netty.buffer.Unpooled; import io.netty.channel.ChannelFutureListener; import io.netty.channel.ChannelHandlerContext; import io.netty.channel.SimpleChannelInboundHandler; import io.netty.handler.codec.http.DefaultFullHttpResponse; import io.netty.handler.codec.http.FullHttpRequest; import io.netty.handler.codec.http.FullHttpResponse; import io.netty.handler.codec.http.HttpHeaderNames; import io.netty.handler.codec.http.HttpResponseStatus; import io.netty.handler.codec.http.HttpVersion; import io.netty.util.CharsetUtil; public class HttpRequestHandler extends SimpleChannelInboundHandler&lt;FullHttpRequest&gt; { @Override public void channelReadComplete(ChannelHandlerContext ctx) { ctx.flush(); } @Override protected void channelRead0(ChannelHandlerContext ctx, FullHttpRequest req) throws Exception { // 处理数据 Date date = new Date(System.currentTimeMillis()); String uri = req.uri(); Map&lt;String,String&gt; data = new HashMap&lt;&gt;(); String protocal = req.protocolVersion().text(); //获取HTTP协议版本 String content = req.content().toString(CharsetUtil.UTF_8); //获取HTTP协议版本 System.out.println(&quot;request uri:&quot; + uri); System.out.println(&quot;request content:&quot; + content); boolean match = false; if(uri.contains(&quot;J&quot;)) { match = true; } data.put(&quot;match&quot;, String.valueOf(match)); data.put(&quot;protocal&quot;, protocal); data.put(&quot;uri&quot;, uri); data.put(&quot;time&quot;, date.toString()); data.put(&quot;content&quot;, content); System.getProperty(&quot;HOST&quot;); String responsedata = &quot;{&quot;; Set&lt;String&gt; keySet = data.keySet(); int size = data.size(); for (String key : keySet) { size --; responsedata = responsedata + &quot;\&quot;&quot; + key + &quot;\&quot;:&quot; + &quot;\&quot;&quot; + data.get(key) + (size == 0? &quot;\&quot;}&quot; : &quot;\&quot;,&quot;); } // 创建http响应 FullHttpResponse response = new DefaultFullHttpResponse( HttpVersion.HTTP_1_1, HttpResponseStatus.OK, Unpooled.copiedBuffer(responsedata, CharsetUtil.UTF_8)); // 设置头信息 response.headers().set(HttpHeaderNames.CONTENT_TYPE, &quot;application/json; charset=UTF-8&quot;); // 将处理后的数据 write到客户端、 ctx.writeAndFlush(response).addListener(ChannelFutureListener.CLOSE); } } 启动 main方法启动服务 1 2 3 4 public static void main(String[] args) throws Exception{ HttpServer server = new HttpServer(80);// 80为启动端口 server.start(); } 1 server start... port : 80 客户端测试 浏览器发送请求 直接url栏输入get请求： 1 http://localhost/test?name=J&amp;time=-1 返回结果 1 2 3 4 5 6 7 { &quot;match&quot;:&quot;true&quot;, &quot;time&quot;:&quot;Sun Jul 11 21:52:22 CST 2021&quot;, &quot;protocal&quot;:&quot;HTTP/1.1&quot;, &quot;uri&quot;:&quot;/test?name=J&amp;time=-1&quot;, &quot;content&quot;:&quot;&quot; } 发送请求 1 http://localhost/test?name=nos&amp;time=-1 返回结果 1 2 3 4 5 6 7 { &quot;match&quot;:&quot;false&quot;, &quot;time&quot;:&quot;Sun Jul 11 21:52:22 CST 2021&quot;, &quot;protocal&quot;:&quot;HTTP/1.1&quot;, &quot;uri&quot;:&quot;/test?name=nos&amp;time=-1&quot;, &quot;content&quot;:&quot;&quot; }" /><link rel="canonical" href="https://narule.github.io/posts/%E5%85%B3%E4%BA%8Enetty/" /><meta property="og:url" content="https://narule.github.io/posts/%E5%85%B3%E4%BA%8Enetty/" /><meta property="og:site_name" content="Narule" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-07-11T00:20:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="关于netty" /><meta name="twitter:site" content="@no_twitter" /><meta name="twitter:creator" content="@Narule" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"关于netty netty 是一个非阻塞IO框架，用于Java网络应用开发，特点是异步处理，并发处理能力，netty里面包含有reactor框架的实现，是一个非常高级的框架体系。 netty特性 netty 处理快，更少的资源需求，响应快，可以作为高并发场景服务器的一个选择 reactor 个人理解是 react：响应式， or ：对象，就是响应式框架，netty 就是运用reactor 的核心设计思想编写的高性能高并发网络请求处理器框架。 以下来自维基百科，自由的百科全书 跳到导航跳到搜索 注意：本条目主题可能尚无中文译名，因而使用原文或其拉丁字母转写作为标题。如果您在可靠来源中找到本主题的中文名称，请勇于将其移动至中文标题。（2019年2月）   开发者 Netty项目社区 稳定版本 4.1.31.Final[1]（2018年10月30日，2年前） 预览版本 5.0.0.Alpha3（2016年1月14日，5年前） 源代码库 github.com/netty/netty 编程语言 Java 类型 Enterprise Integration Patterns Message Oriented Middleware 许可协议 Apache许可证 2.0 网站 netty.io Netty是一个非阻塞I/O客户端-服务器框架，主要用于开发Java网络应用程序，如协议服务器和客户端。异步事件驱动的网络应用程序框架和工具用于简化网络编程，例如TCP和UDP套接字服务器。[2]Netty包括了反应器编程模式的实现。Netty最初由JBoss开发，现在由Netty项目社区开发和维护。 除了作为异步网络应用程序框架，Netty还包括了对HTTP、HTTP2、DNS及其他协议的支持，涵盖了在Servlet容器内运行的能力、对WebSockets的支持、与Google Protocol Buffers的集成、对SSL/TLS的支持以及对用于SPDY协议和消息压缩的支持。自2004年以来，Netty一直在被积极开发。[3] 从版本4.0.0开始，Netty在支持NIO和阻塞Java套接字的同时，还支持使用NIO.2作为后端。 用netty写一个简单非阻塞请求响应服务器 简单示意代码 服务端 服务器 HttpServer 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 package net.narule.jnetty.httpdemo; import io.netty.bootstrap.ServerBootstrap; import io.netty.channel.ChannelFuture; import io.netty.channel.EventLoopGroup; import io.netty.channel.nio.NioEventLoopGroup; import io.netty.channel.socket.nio.NioServerSocketChannel; import io.netty.handler.logging.LogLevel; import io.netty.handler.logging.LoggingHandler; import java.net.InetSocketAddress; /** * netty server */ public class HttpServer { int port ; public HttpServer(int port){ this.port = port; } public void start() throws Exception{ ServerBootstrap bootstrap = new ServerBootstrap(); // 事件监听相关对象配置 netty 循环监听是否有新事件 // 如果有 马上将事件交给处理器，处理器层层循环处理，会循环到自定义消息解析器 HttpRequestHandler EventLoopGroup boss = new NioEventLoopGroup(); EventLoopGroup work = new NioEventLoopGroup(); bootstrap.group(boss,work) .handler(new LoggingHandler(LogLevel.DEBUG)) .channel(NioServerSocketChannel.class) .childHandler(new HttpServerInitializer()); ChannelFuture f = bootstrap.bind(new InetSocketAddress(port)).sync(); System.out.println(&quot;server start... port : &quot; + port); f.channel().closeFuture().sync(); } } 请求处理器初始化 HttpServerInitializer initChannel 处理器配置。可以配置多个 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 package net.narule.jnetty.httpdemo; import io.netty.channel.ChannelInitializer; import io.netty.channel.ChannelPipeline; import io.netty.channel.socket.SocketChannel; import io.netty.handler.codec.http.HttpObjectAggregator; import io.netty.handler.codec.http.HttpServerCodec; public class HttpServerInitializer extends ChannelInitializer&lt;SocketChannel&gt; { @Override protected void initChannel(SocketChannel ch) throws Exception { ChannelPipeline pipeline = ch.pipeline(); // http 编解码 pipeline.addLast(new HttpServerCodec()); // http 消息聚合器 512*1024为接收的最大contentlength pipeline.addLast(&quot;httpAggregator&quot;,new HttpObjectAggregator(512*1024)); // 请求处理器 pipeline.addLast(new HttpRequestHandler()); } } 消息处理器 HttpRequestHandler 重写channelRead0 方法处理请求的消息并返回 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 package net.narule.jnetty.httpdemo; import java.util.Date; import java.util.HashMap; import java.util.Map; import java.util.Set; import io.netty.buffer.Unpooled; import io.netty.channel.ChannelFutureListener; import io.netty.channel.ChannelHandlerContext; import io.netty.channel.SimpleChannelInboundHandler; import io.netty.handler.codec.http.DefaultFullHttpResponse; import io.netty.handler.codec.http.FullHttpRequest; import io.netty.handler.codec.http.FullHttpResponse; import io.netty.handler.codec.http.HttpHeaderNames; import io.netty.handler.codec.http.HttpResponseStatus; import io.netty.handler.codec.http.HttpVersion; import io.netty.util.CharsetUtil; public class HttpRequestHandler extends SimpleChannelInboundHandler&lt;FullHttpRequest&gt; { @Override public void channelReadComplete(ChannelHandlerContext ctx) { ctx.flush(); } @Override protected void channelRead0(ChannelHandlerContext ctx, FullHttpRequest req) throws Exception { // 处理数据 Date date = new Date(System.currentTimeMillis()); String uri = req.uri(); Map&lt;String,String&gt; data = new HashMap&lt;&gt;(); String protocal = req.protocolVersion().text(); //获取HTTP协议版本 String content = req.content().toString(CharsetUtil.UTF_8); //获取HTTP协议版本 System.out.println(&quot;request uri:&quot; + uri); System.out.println(&quot;request content:&quot; + content); boolean match = false; if(uri.contains(&quot;J&quot;)) { match = true; } data.put(&quot;match&quot;, String.valueOf(match)); data.put(&quot;protocal&quot;, protocal); data.put(&quot;uri&quot;, uri); data.put(&quot;time&quot;, date.toString()); data.put(&quot;content&quot;, content); System.getProperty(&quot;HOST&quot;); String responsedata = &quot;{&quot;; Set&lt;String&gt; keySet = data.keySet(); int size = data.size(); for (String key : keySet) { size --; responsedata = responsedata + &quot;\\&quot;&quot; + key + &quot;\\&quot;:&quot; + &quot;\\&quot;&quot; + data.get(key) + (size == 0? &quot;\\&quot;}&quot; : &quot;\\&quot;,&quot;); } // 创建http响应 FullHttpResponse response = new DefaultFullHttpResponse( HttpVersion.HTTP_1_1, HttpResponseStatus.OK, Unpooled.copiedBuffer(responsedata, CharsetUtil.UTF_8)); // 设置头信息 response.headers().set(HttpHeaderNames.CONTENT_TYPE, &quot;application/json; charset=UTF-8&quot;); // 将处理后的数据 write到客户端、 ctx.writeAndFlush(response).addListener(ChannelFutureListener.CLOSE); } } 启动 main方法启动服务 1 2 3 4 public static void main(String[] args) throws Exception{ HttpServer server = new HttpServer(80);// 80为启动端口 server.start(); } 1 server start... port : 80 客户端测试 浏览器发送请求 直接url栏输入get请求： 1 http://localhost/test?name=J&amp;time=-1 返回结果 1 2 3 4 5 6 7 { &quot;match&quot;:&quot;true&quot;, &quot;time&quot;:&quot;Sun Jul 11 21:52:22 CST 2021&quot;, &quot;protocal&quot;:&quot;HTTP/1.1&quot;, &quot;uri&quot;:&quot;/test?name=J&amp;time=-1&quot;, &quot;content&quot;:&quot;&quot; } 发送请求 1 http://localhost/test?name=nos&amp;time=-1 返回结果 1 2 3 4 5 6 7 { &quot;match&quot;:&quot;false&quot;, &quot;time&quot;:&quot;Sun Jul 11 21:52:22 CST 2021&quot;, &quot;protocal&quot;:&quot;HTTP/1.1&quot;, &quot;uri&quot;:&quot;/test?name=nos&amp;time=-1&quot;, &quot;content&quot;:&quot;&quot; }","headline":"关于netty","dateModified":"2021-07-12T00:24:17+08:00","datePublished":"2021-07-11T00:20:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://narule.github.io/posts/%E5%85%B3%E4%BA%8Enetty/"},"url":"https://narule.github.io/posts/%E5%85%B3%E4%BA%8Enetty/","author":{"@type":"Person","name":"Narule"},"@type":"BlogPosting","@context":"https://schema.org"}</script><title>关于netty | Narule</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-JVHJ82NYZT"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-JVHJ82NYZT'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://narule.github.io/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Narule</a></div><div class="site-subtitle font-italic">A Blog for Article; Chinese Blog is www.cnblogs.com/narule</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/narule" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/no_twitter" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['narule','163.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>关于netty</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>关于netty</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Jul 11, 2021, 12:20 AM +0800" > Jul 11, 2021 <i class="unloaded">2021-07-11T00:20:00+08:00</i> </span> by <span class="author"> Narule </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Jul 12, 2021, 12:24 AM +0800" > Jul 12, 2021 <i class="unloaded">2021-07-12T00:24:17+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1294 words">7 min</span></div></div><div class="post-content"><h1 id="关于netty">关于netty</h1><p>netty 是一个非阻塞IO框架，用于Java网络应用开发，特点是异步处理，并发处理能力，netty里面包含有reactor框架的实现，是一个非常高级的框架体系。</p><h2 id="netty特性">netty特性</h2><p>netty 处理快，更少的资源需求，响应快，可以作为高并发场景服务器的一个选择</p><p>reactor 个人理解是 react：响应式， or ：对象，就是响应式框架，netty 就是运用reactor 的核心设计思想编写的高性能高并发网络请求处理器框架。</p><p>以下来自维基百科，自由的百科全书</p><p><a href="https://zh.wikipedia.org/wiki/Netty#mw-head">跳到导航</a><a href="https://zh.wikipedia.org/wiki/Netty#searchInput">跳到搜索</a></p><p><strong>注意</strong>：本条目主题可能尚无中文译名，因而使用原文或其拉丁字母转写作为标题。如果您在<a href="https://zh.wikipedia.org/wiki/Wikipedia:可靠來源">可靠来源</a>中找到本主题的中文名称，请<a href="https://zh.wikipedia.org/wiki/Wikipedia:勇于更新页面">勇于</a>将其<a href="https://zh.wikipedia.org/wiki/Wikipedia:移動請求">移动</a>至中文标题。（2019年2月）</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left"><a href="https://zh.wikipedia.org/wiki/File:JBoss-Netty-logo.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://upload.wikimedia.org/wikipedia/commons/8/87/JBoss-Netty-logo.png" alt="JBoss-Netty-logo.png" /></a><th> <tbody><tr><td style="text-align: left"><a href="https://zh.wikipedia.org/wiki/软件开发">开发者</a><td>Netty项目社区<tr><td style="text-align: left"><a href="https://zh.wikipedia.org/wiki/軟件版本週期">稳定版本</a><td>4.1.31.Final[<a href="https://zh.wikipedia.org/wiki/Netty#cite_note-1">1]</a>（2018年10月30日，2年前）<tr><td style="text-align: left"><a href="https://zh.wikipedia.org/wiki/軟件版本週期">预览版本</a><td>5.0.0.Alpha3（2016年1月14日，5年前）<tr><td style="text-align: left"><a href="https://zh.wikipedia.org/wiki/仓库_(版本控制)">源代码库</a><td><a href="https://github.com/netty/netty">github.com/netty/netty</a><a href="https://www.wikidata.org/wiki/Q6107820#P1324"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/OOjs_UI_icon_edit-ltr-progressive.svg/10px-OOjs_UI_icon_edit-ltr-progressive.svg.png" alt="编辑维基数据链接" /></a><tr><td style="text-align: left"><a href="https://zh.wikipedia.org/wiki/编程语言">编程语言</a><td><a href="https://zh.wikipedia.org/wiki/Java">Java</a><tr><td style="text-align: left">类型<td><a href="https://zh.wikipedia.org/w/index.php?title=Enterprise_Integration_Patterns&amp;action=edit&amp;redlink=1">Enterprise Integration Patterns</a> <a href="https://zh.wikipedia.org/w/index.php?title=Message_Oriented_Middleware&amp;action=edit&amp;redlink=1">Message Oriented Middleware</a><tr><td style="text-align: left"><a href="https://zh.wikipedia.org/wiki/软件许可证">许可协议</a><td><a href="https://zh.wikipedia.org/wiki/Apache许可证">Apache许可证</a> 2.0<tr><td style="text-align: left">网站<td><a href="https://netty.io/">netty.io</a> <a href="https://www.wikidata.org/wiki/Q6107820?uselang=zh-cn#P856"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/OOjs_UI_icon_edit-ltr-progressive.svg/10px-OOjs_UI_icon_edit-ltr-progressive.svg.png" alt="编辑维基数据" /></a></table></div><p><strong>Netty</strong>是一个<a href="https://zh.wikipedia.org/wiki/异步IO">非阻塞I/O</a>客户端-服务器<a href="https://zh.wikipedia.org/wiki/軟體框架">框架</a>，主要用于开发<a href="https://zh.wikipedia.org/wiki/Java">Java</a>网络应用程序，如协议服务器和客户端。异步<a href="https://zh.wikipedia.org/wiki/事件驱动的编程">事件驱动</a>的网络应用程序框架和工具用于简化网络编程，例如<a href="https://zh.wikipedia.org/wiki/传输控制协议">TCP</a>和<a href="https://zh.wikipedia.org/wiki/用户数据报协议">UDP</a>套接字服务器。[<a href="https://zh.wikipedia.org/wiki/Netty#cite_note-2">2]</a>Netty包括了<a href="https://zh.wikipedia.org/wiki/反应器模式">反应器编程模式</a>的实现。Netty最初由<a href="https://zh.wikipedia.org/wiki/JBoss">JBoss</a>开发，现在由Netty项目社区开发和维护。</p><p>除了作为异步网络应用程序框架，Netty还包括了对<a href="https://zh.wikipedia.org/wiki/超文本传输协议">HTTP</a>、<a href="https://zh.wikipedia.org/wiki/HTTP/2">HTTP2</a>、<a href="https://zh.wikipedia.org/wiki/域名系统">DNS</a>及其他协议的支持，涵盖了在<a href="https://zh.wikipedia.org/wiki/Servlet容器">Servlet容器</a>内运行的能力、对<a href="https://zh.wikipedia.org/wiki/WebSocket">WebSockets</a>的支持、与<a href="https://zh.wikipedia.org/wiki/Google">Google</a> <a href="https://zh.wikipedia.org/wiki/Protocol_Buffers">Protocol Buffers</a>的集成、对<a href="https://zh.wikipedia.org/wiki/傳輸層安全性協定">SSL</a>/<a href="https://zh.wikipedia.org/wiki/傳輸層安全性協定">TLS</a>的支持以及对用于<a href="https://zh.wikipedia.org/wiki/SPDY">SPDY</a>协议和消息<a href="https://zh.wikipedia.org/wiki/数据压缩">压缩</a>的支持。自2004年以来，Netty一直在被积极开发。[<a href="https://zh.wikipedia.org/wiki/Netty#cite_note-3">3]</a></p><p>从版本4.0.0开始，Netty在支持<a href="https://zh.wikipedia.org/wiki/Java_NIO">NIO</a>和阻塞Java套接字的同时，还支持使用NIO.2作为后端。</p><h1 id="用netty写一个简单非阻塞请求响应服务器">用netty写一个简单非阻塞请求响应服务器</h1><h2 id="简单示意代码">简单示意代码</h2><h3 id="服务端">服务端</h3><h4 id="服务器-httpserver">服务器 HttpServer</h4><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">net.narule.jnetty.httpdemo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">io.netty.bootstrap.ServerBootstrap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.channel.ChannelFuture</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.channel.EventLoopGroup</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.channel.nio.NioEventLoopGroup</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.channel.socket.nio.NioServerSocketChannel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.handler.logging.LogLevel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.handler.logging.LoggingHandler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.net.InetSocketAddress</span><span class="o">;</span>

<span class="cm">/**
 * netty server
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HttpServer</span> <span class="o">{</span>

    <span class="kt">int</span> <span class="n">port</span> <span class="o">;</span>

    <span class="kd">public</span> <span class="nf">HttpServer</span><span class="o">(</span><span class="kt">int</span> <span class="n">port</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">port</span> <span class="o">=</span> <span class="n">port</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
        <span class="nc">ServerBootstrap</span> <span class="n">bootstrap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerBootstrap</span><span class="o">();</span>
        <span class="c1">// 事件监听相关对象配置 netty 循环监听是否有新事件</span>
        <span class="c1">// 如果有 马上将事件交给处理器，处理器层层循环处理，会循环到自定义消息解析器  HttpRequestHandler</span>
        <span class="nc">EventLoopGroup</span> <span class="n">boss</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NioEventLoopGroup</span><span class="o">();</span>
        <span class="nc">EventLoopGroup</span> <span class="n">work</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NioEventLoopGroup</span><span class="o">();</span>
        <span class="n">bootstrap</span><span class="o">.</span><span class="na">group</span><span class="o">(</span><span class="n">boss</span><span class="o">,</span><span class="n">work</span><span class="o">)</span>
                <span class="o">.</span><span class="na">handler</span><span class="o">(</span><span class="k">new</span> <span class="nc">LoggingHandler</span><span class="o">(</span><span class="nc">LogLevel</span><span class="o">.</span><span class="na">DEBUG</span><span class="o">))</span>
                <span class="o">.</span><span class="na">channel</span><span class="o">(</span><span class="nc">NioServerSocketChannel</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">.</span><span class="na">childHandler</span><span class="o">(</span><span class="k">new</span> <span class="nc">HttpServerInitializer</span><span class="o">());</span>

        <span class="nc">ChannelFuture</span> <span class="n">f</span> <span class="o">=</span> <span class="n">bootstrap</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="k">new</span> <span class="nc">InetSocketAddress</span><span class="o">(</span><span class="n">port</span><span class="o">)).</span><span class="na">sync</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"server start... port : "</span> <span class="o">+</span> <span class="n">port</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">channel</span><span class="o">().</span><span class="na">closeFuture</span><span class="o">().</span><span class="na">sync</span><span class="o">();</span>

    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><h4 id="请求处理器初始化-httpserverinitializer">请求处理器初始化 HttpServerInitializer</h4><p>initChannel 处理器配置。可以配置多个</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">net.narule.jnetty.httpdemo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">io.netty.channel.ChannelInitializer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.channel.ChannelPipeline</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.channel.socket.SocketChannel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.handler.codec.http.HttpObjectAggregator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.handler.codec.http.HttpServerCodec</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HttpServerInitializer</span> <span class="kd">extends</span> <span class="nc">ChannelInitializer</span><span class="o">&lt;</span><span class="nc">SocketChannel</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">initChannel</span><span class="o">(</span><span class="nc">SocketChannel</span> <span class="n">ch</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		<span class="nc">ChannelPipeline</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ch</span><span class="o">.</span><span class="na">pipeline</span><span class="o">();</span>
		<span class="c1">// http 编解码</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="na">addLast</span><span class="o">(</span><span class="k">new</span> <span class="nc">HttpServerCodec</span><span class="o">());</span>
        <span class="c1">// http 消息聚合器                                                                     512*1024为接收的最大contentlength</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="na">addLast</span><span class="o">(</span><span class="s">"httpAggregator"</span><span class="o">,</span><span class="k">new</span> <span class="nc">HttpObjectAggregator</span><span class="o">(</span><span class="mi">512</span><span class="o">*</span><span class="mi">1024</span><span class="o">));</span> 
        <span class="c1">// 请求处理器</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="na">addLast</span><span class="o">(</span><span class="k">new</span> <span class="nc">HttpRequestHandler</span><span class="o">());</span>
		
	<span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h4 id="消息处理器-httprequesthandler">消息处理器 HttpRequestHandler</h4><p>重写channelRead0 方法处理请求的消息并返回</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">net.narule.jnetty.httpdemo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">io.netty.buffer.Unpooled</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.channel.ChannelFutureListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.channel.ChannelHandlerContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.channel.SimpleChannelInboundHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.handler.codec.http.DefaultFullHttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.handler.codec.http.FullHttpRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.handler.codec.http.FullHttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.handler.codec.http.HttpHeaderNames</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.handler.codec.http.HttpResponseStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.handler.codec.http.HttpVersion</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.netty.util.CharsetUtil</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HttpRequestHandler</span> <span class="kd">extends</span> <span class="nc">SimpleChannelInboundHandler</span><span class="o">&lt;</span><span class="nc">FullHttpRequest</span><span class="o">&gt;</span> <span class="o">{</span>

	    <span class="nd">@Override</span>
	    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">channelReadComplete</span><span class="o">(</span><span class="nc">ChannelHandlerContext</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
	        <span class="n">ctx</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
	    <span class="o">}</span>

	    <span class="nd">@Override</span>
	    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">channelRead0</span><span class="o">(</span><span class="nc">ChannelHandlerContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="nc">FullHttpRequest</span> <span class="n">req</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
			<span class="c1">// 处理数据</span>
	    	<span class="nc">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>
	        <span class="nc">String</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">uri</span><span class="o">();</span>
	        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
	        <span class="nc">String</span> <span class="n">protocal</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">protocolVersion</span><span class="o">().</span><span class="na">text</span><span class="o">();</span> <span class="c1">//获取HTTP协议版本</span>
	        <span class="nc">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">content</span><span class="o">().</span><span class="na">toString</span><span class="o">(</span><span class="nc">CharsetUtil</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span> <span class="c1">//获取HTTP协议版本</span>
	        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request uri:"</span> <span class="o">+</span> <span class="n">uri</span><span class="o">);</span>
	        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request content:"</span> <span class="o">+</span> <span class="n">content</span><span class="o">);</span>
	        <span class="kt">boolean</span> <span class="n">match</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> 
	        <span class="k">if</span><span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"J"</span><span class="o">))</span> <span class="o">{</span>
	        	<span class="n">match</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
	        <span class="o">}</span>
	        <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"match"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">match</span><span class="o">));</span>
	        <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"protocal"</span><span class="o">,</span> <span class="n">protocal</span><span class="o">);</span>
	        <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"uri"</span><span class="o">,</span> <span class="n">uri</span><span class="o">);</span>
	        <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"time"</span><span class="o">,</span> <span class="n">date</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
	        <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"content"</span><span class="o">,</span> <span class="n">content</span><span class="o">);</span>
	        <span class="nc">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"HOST"</span><span class="o">);</span>
	        <span class="nc">String</span> <span class="n">responsedata</span> <span class="o">=</span> <span class="s">"{"</span><span class="o">;</span>
	        <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">keySet</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">keySet</span><span class="o">();</span>
	        <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
	        <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">key</span> <span class="o">:</span> <span class="n">keySet</span><span class="o">)</span> <span class="o">{</span>
	        	<span class="n">size</span> <span class="o">--;</span>
	        	<span class="n">responsedata</span> <span class="o">=</span> <span class="n">responsedata</span> <span class="o">+</span> <span class="s">"\""</span> <span class="o">+</span> <span class="n">key</span>  <span class="o">+</span> <span class="s">"\":"</span> <span class="o">+</span> <span class="s">"\""</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">)</span> <span class="o">+</span> <span class="o">(</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="o">?</span> <span class="s">"\"}"</span> <span class="o">:</span> <span class="s">"\","</span><span class="o">);</span>
			<span class="o">}</span>
	        
	        <span class="c1">// 创建http响应</span>
	        <span class="nc">FullHttpResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DefaultFullHttpResponse</span><span class="o">(</span>
	                                        <span class="nc">HttpVersion</span><span class="o">.</span><span class="na">HTTP_1_1</span><span class="o">,</span>
	                                        <span class="nc">HttpResponseStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">,</span>
	                                        <span class="nc">Unpooled</span><span class="o">.</span><span class="na">copiedBuffer</span><span class="o">(</span><span class="n">responsedata</span><span class="o">,</span> <span class="nc">CharsetUtil</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">));</span>
	       <span class="c1">// 设置头信息</span>
	        <span class="n">response</span><span class="o">.</span><span class="na">headers</span><span class="o">().</span><span class="na">set</span><span class="o">(</span><span class="nc">HttpHeaderNames</span><span class="o">.</span><span class="na">CONTENT_TYPE</span><span class="o">,</span> <span class="s">"application/json; charset=UTF-8"</span><span class="o">);</span>
	       <span class="c1">// 将处理后的数据 write到客户端、</span>
	        <span class="n">ctx</span><span class="o">.</span><span class="na">writeAndFlush</span><span class="o">(</span><span class="n">response</span><span class="o">).</span><span class="na">addListener</span><span class="o">(</span><span class="nc">ChannelFutureListener</span><span class="o">.</span><span class="na">CLOSE</span><span class="o">);</span>
	    <span class="o">}</span>
	    
<span class="o">}</span>
</pre></table></code></div></div><h3 id="启动">启动</h3><p>main方法启动服务</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
        <span class="nc">HttpServer</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HttpServer</span><span class="o">(</span><span class="mi">80</span><span class="o">);</span><span class="c1">// 80为启动端口</span>
        <span class="n">server</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>server start... port : 80
</pre></table></code></div></div><h3 id="客户端测试">客户端测试</h3><p>浏览器发送请求</p><p>直接url栏输入get请求：</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://localhost/test?name<span class="o">=</span>J&amp;time<span class="o">=</span><span class="nt">-1</span>
</pre></table></code></div></div><p>返回结果</p><div class="language-json highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"match"</span><span class="p">:</span><span class="s2">"true"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"time"</span><span class="p">:</span><span class="s2">"Sun Jul 11 21:52:22 CST 2021"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"protocal"</span><span class="p">:</span><span class="s2">"HTTP/1.1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"uri"</span><span class="p">:</span><span class="s2">"/test?name=J&amp;time=-1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"content"</span><span class="p">:</span><span class="s2">""</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>发送请求</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://localhost/test?name<span class="o">=</span>nos&amp;time<span class="o">=</span><span class="nt">-1</span>
</pre></table></code></div></div><p>返回结果</p><div class="language-json highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"match"</span><span class="p">:</span><span class="s2">"false"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"time"</span><span class="p">:</span><span class="s2">"Sun Jul 11 21:52:22 CST 2021"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"protocal"</span><span class="p">:</span><span class="s2">"HTTP/1.1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"uri"</span><span class="p">:</span><span class="s2">"/test?name=nos&amp;time=-1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"content"</span><span class="p">:</span><span class="s2">""</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/technology-%E6%8A%80%E6%9C%AF/'>Technology^技术</a>, <a href='/categories/java/'>Java</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/writing/" class="post-tag no-text-decoration" >writing</a> <a href="/tags/java/" class="post-tag no-text-decoration" >Java</a> <a href="/tags/netty/" class="post-tag no-text-decoration" >netty</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=关于netty - Narule&url=https://narule.github.io/posts/%E5%85%B3%E4%BA%8Enetty/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=关于netty - Narule&u=https://narule.github.io/posts/%E5%85%B3%E4%BA%8Enetty/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=关于netty - Narule&url=https://narule.github.io/posts/%E5%85%B3%E4%BA%8Enetty/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/%E4%BA%92%E8%81%94%E7%BD%91%E5%A4%87%E5%BF%98%E5%BD%95/">互联网备忘录</a><li><a href="/posts/%E7%94%A8%E6%88%B7%E6%8C%87%E7%BA%B9/">用户指纹</a><li><a href="/posts/%E5%85%B3%E4%BA%8Enetty/">关于netty</a><li><a href="/posts/%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%E5%8D%9A%E5%AE%A2%E7%9A%84%E8%AE%BE%E8%AE%A1-The-design-of-an-automatically-updated-blog/">The design of an automatically updated blog | 自动更新博客的设计</a><li><a href="/posts/AbstractQueuedSynchronizer%E6%8A%BD%E8%B1%A1%E7%B1%BB-%E9%98%BB%E5%A1%9E%E9%94%81/">AbstractQueuedSynchronizer抽象类-阻塞锁</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writing/">writing</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/think/">Think</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/website/">website</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/map/">map</a> <a class="post-tag" href="/tags/nginx/">nginx</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/AbstractQueuedSynchronizer%E6%8A%BD%E8%B1%A1%E7%B1%BB-%E9%98%BB%E5%A1%9E%E9%94%81/"><div class="card-body"> <span class="timeago small" > Mar 20, 2021 <i class="unloaded">2021-03-20T00:10:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AbstractQueuedSynchronizer抽象类-阻塞锁</h3><div class="text-muted small"><p> AbstractQueuedSynchronizer抽象类-阻塞锁 AbstractQueuedSynchronizer是多线程情况下保证代码快有序运行的一种设计，对多线程获取锁进行了抽象， 设计中包括： 1.线程队列（阻塞的线程） 当很多线程竞争锁的时候，排队一个个获取锁，先进先出 2.线程获取锁，成功就执行后面的代码 3.线程释放锁，如果等待队列中有线程，唤醒队列中的线程 ...</p></div></div></a></div><div class="card"> <a href="/posts/Java-jvm%E8%B0%83%E4%BC%98%E6%96%87%E6%A1%A3%E6%91%98%E8%A6%81/"><div class="card-body"> <span class="timeago small" > Sep 26, 2021 <i class="unloaded">2021-09-26T00:10:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Java-jvm调优文档摘要</h3><div class="text-muted small"><p> Java-jvm调优文档摘要 官方文档：https://docs.oracle.com/en/java/javase/16/gctuning/factors-affecting-garbage-collection-performance.html 关于官方文档的理解，jdk版本不同参数略有区别，特别是jdk1.8之后的改动，取消了永久代这个区域，1.8没有ZGC垃圾回收器，但jdk16...</p></div></div></a></div><div class="card"> <a href="/posts/java%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/"><div class="card-body"> <span class="timeago small" > Oct 11, 2018 <i class="unloaded">2018-10-11T20:10:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>java面向对象设计原则</h3><div class="text-muted small"><p> 总原则 开闭原则（OCP：Open Closed Principle） 　　对扩展开放，对修改关闭。设计功能模块的时候，应当使这个模块在不被修改的前提下可以被扩展（功能） 一 里氏替换原则 （LSP：Liskov Substitution Principle） 　　对于父类出现的地方，都可以用子类代替（多态，继承） 二 单一职责原则（SRP：Single responsibility...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/%E5%9F%BA%E4%BA%8E%E9%9A%8F%E6%9C%BA%E5%AE%9A%E4%BD%8D%E7%9A%84%E5%9C%B0%E5%9B%BE%E4%BF%A1%E6%81%AF%E8%8E%B7%E5%8F%96%E7%AE%97%E6%B3%95/" class="btn btn-outline-primary"><p>基于随机定位的地图信息获取方式</p></a> <a href="/posts/Java-jvm%E8%B0%83%E4%BC%98%E6%96%87%E6%A1%A3%E6%91%98%E8%A6%81/" class="btn btn-outline-primary"><p>Java-jvm调优文档摘要</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://narule.github.io/posts/%E5%85%B3%E4%BA%8Enetty/'; this.page.identifier = '/posts/%E5%85%B3%E4%BA%8Enetty/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://cnblogs.com/narule">narule</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/writing/">writing</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/think/">Think</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/website/">website</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/map/">map</a> <a class="post-tag" href="/tags/nginx/">nginx</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://narule.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
