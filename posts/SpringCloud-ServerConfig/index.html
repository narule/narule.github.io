<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="SpringCloud-ServerConfig" /><meta name="author" content="Narule" /><meta property="og:locale" content="en_US" /><meta name="description" content="ServerConfig SpringCloud 组件，ServerConfig 是配置服务中心，组件，用于统一管理项目配置’’ 原理 读取配置文件内容到服务中心 通过启动一个springboot服务（server-config），配置好git仓库地址（也可以svn或者其他），通过配置好的文件地址，访问配置文件，将配置读取到服务中心，并且文件内容修改后，可以实时刷新。 客户端到配置中心读配置内容 其他微服务访问配置不需要访问git，只需要通过访问ServerConfig读取配置，能到达统一配置的目的。 搭建 前提概要，本搭建使用ide:Spring Tool Suite 4 Version: 4.3.0.RELEASE Build Id: 201906200901 安装好maven 3.6.3，并配置好网络通畅的maven仓库地址，有些国外仓库地址可能网速不好，下载依赖慢。 国内镜像仓库反而更快 https://www.cnblogs.com/Narule/p/12595960.html Server file -&gt; new -&gt; Spring Starter Project pom依赖 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.2.5.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.wunanyu&lt;/groupId&gt; &lt;artifactId&gt;Config&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;Config&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;spring-cloud.version&gt;Hoxton.SR3&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring-cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; 配置文件 application.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 server: port: 8888 # 服务端口号 spring: application: name: server-config #服务名 cloud: config: server: git: uri: /usr/data/git/cloud/config #linux配置文件地址 # 这里可以配置文件路径，也可以配置服务器路径，windows需要添加// # 如uri: file://${user.home}/config-repo # github uri：https：//github.com/repo # #logging: #config: src/main/resources/logback-spring.xml log: path: log #日志路径 更详细可以见https://www.cnblogs.com/hellxz/p/9306507.html logback-spring.xml 日志打印的配置文件已经配置好，可以直接用，这里不介绍logback细节，不是本次重点 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;!-- 配置说明 %6 表示字段最小长度为6，格式右对齐 [ 右对齐 ] %-64 表示最小长度64，并且左对齐 [左对齐 ] %6.32 表示最小长度6，最大长度32 [左对齐 ] --&gt; &lt;configuration scan=&quot;true&quot; scanPeriod=&quot;60 seconds&quot; debug=&quot;false&quot;&gt; &lt;!-- 默认读取application.yml 配置 --&gt; &lt;springProperty scope=&quot;contex&quot; name=&quot;app&quot; source=&quot;spring.application.name&quot;&gt;&lt;/springProperty&gt; &lt;springProperty scope=&quot;contex&quot; name=&quot;log.path&quot; source=&quot;log.path&quot;&gt;&lt;/springProperty&gt; &lt;!-- &lt;property name=&quot;log.path&quot; value=&quot;log&quot; /&gt; --&gt; &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d -%magenta(%6(${PID:- }))- [%-5(${app})] [%6thread] %-5level %cyan(%-64logger{128}) - %msg%n&quot; /&gt; &lt;!-- 时间 进程 线程 日志级别 输出对象 消息内容 --&gt; &lt;!-- 彩色 --&gt; &lt;!-- &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d -%magenta(${PID:- })- [%16thread] %customcolor(%-5level) %cyan(%-64logger{128}) - %msg%n&quot; /&gt; --&gt; &lt;!-- 黑白日志 --&gt; &lt;!-- &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d -%6(${PID:- })- [%16thread] %-5level %-64logger{128} - %msg%n&quot; /&gt; --&gt; &lt;!-- &lt;contextName&gt;${app}&lt;/contextName&gt; --&gt; &lt;!--输出到控制台 --&gt; &lt;appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; &lt;!-- 级别过滤 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;!-- 级别低于INFO 的日志不会被打印 --&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;/filter&gt; &lt;!-- 打印模板 --&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;!-- &lt;pattern&gt;%d -%magenta(${PID:- })- [%16thread] %customcolor(%-5level) %cyan(%-64logger{128}) - %msg%n&lt;/pattern&gt; --&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!--输出到文件 --&gt; &lt;!-- all 日志文件，级别高于info 的全部打印 --&gt; &lt;appender name=&quot;all-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-all.log&lt;/file&gt; &lt;!-- ThresholdFilter级别过滤 级别大于 info 的才会输出 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/all/${app}-all-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.all-log.zip&lt;/fileNamePattern&gt; --&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- info 日志文件 只打印info级别信息 --&gt; &lt;appender name=&quot;info-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-info.log&lt;/file&gt; &lt;!-- 只打印唯一种级别的日志 可以用 LevelFilter 配置 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;!--匹配到就允许 --&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;!--没匹配到就禁止 --&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/info/${app}-info-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- warn 日志文件 只打印warn级别信息 --&gt; &lt;appender name=&quot;warn-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-warn.log&lt;/file&gt; &lt;!-- 只打印唯一种级别的日志 可以用 LevelFilter 配置 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;WARN&lt;/level&gt; &lt;!--匹配到就允许 --&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;!--没匹配到就禁止 --&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/warn/${app}-warn-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;!-- &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.warn-log.zip&lt;/fileNamePattern&gt; 日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; --&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- error 日志文件 只打印error级别信息 --&gt; &lt;appender name=&quot;error-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-error.log&lt;/file&gt; &lt;!-- &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; --&gt; &lt;!--如果只是想要 Error 级别的日志，那么需要过滤一下，默认是 info 级别的，ThresholdFilter --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;level&gt;Error&lt;/level&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/error/${app}-error-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- root 指定打印日志最低级别 --&gt; &lt;root level=&quot;info&quot;&gt; &lt;appender-ref ref=&quot;console&quot; /&gt; &lt;appender-ref ref=&quot;all-file&quot; /&gt; &lt;!-- &lt;appender-ref ref=&quot;trace-file&quot; /&gt; --&gt; &lt;!-- &lt;appender-ref ref=&quot;debug-file&quot; /&gt; --&gt; &lt;appender-ref ref=&quot;info-file&quot; /&gt; &lt;appender-ref ref=&quot;warn-file&quot; /&gt; &lt;appender-ref ref=&quot;error-file&quot; /&gt; &lt;/root&gt; &lt;!-- logback为java中的包 --&gt; &lt;!-- &lt;logger name=&quot;com.baiding&quot;/&gt; --&gt; &lt;!-- java中的包 --&gt; &lt;!-- &lt;logger name=&quot;com.baiding&quot; level=&quot;warn&quot; addtivity=&quot;false&quot;&gt; &lt;appender-ref ref=&quot;console&quot; /&gt; &lt;/logger&gt; --&gt; &lt;!-- &lt;appender name=&quot;trace-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/spring-boot-${log.name}-trace.log&lt;/file&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;TRACE&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.trace-log.zip&lt;/fileNamePattern&gt; 日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; --&gt; &lt;!-- &lt;appender name=&quot;debug-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/spring-boot-${log.name}-debug.log&lt;/file&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;DEBUG&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.debug-log.zip&lt;/fileNamePattern&gt; 日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; --&gt; &lt;/configuration&gt; 启动类 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 package com.wunanyu.cloud.config; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.config.server.EnableConfigServer; @SpringBootApplication //springboot启动类注解 @EnableConfigServer //SpringCloud-ServerConfig配置中心服务注解，表示这是配置服务中心 /** * @author Narule */ public class ConfigApplication { public static void main(String[] args) { SpringApplication.run(ConfigApplication.class, args); } } 启动这个类的main方法，看控制台console的打印日志是否启动成功，启动成功，则可以通过 localhost:8888/eureka-dev.yml 查看配置信息，只要配置地址有这个文件 configserver 配置文件规则 1 2 3 4 5 / { 应用名 } / { 环境名 } [ / { 分支名 } ] / { 应用名 } - { 环境名 }.yml / { 应用名 } - { 环境名 }.properties / { 分支名 } / { 应用名 } - { 环境名 }.yml / { 分支名 } / { 应用名 } - { 环境名 }.properties client 读取配置 如果一个springboot服务叫eureka,eureka配置如下 bootstrap.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 spring: application: name: eureka #应用名 cloud: config: uri: localhost:8888 #配置中心的访问地址 这不是配置文件的地址，是配置服务server-config的地址 profile: dev #环境 label: master #分支 management: endpoints: web: exposure: include: - &quot;*&quot; eureka: server: renewal-percent-threshold: 0.45 log: path: log 那么他会读取的文件名称为eureka-dev.yml, git分支为master的文件(默认) Client Client 其实只是在pom中添加 config依赖 &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt; &lt;/dependency&gt; 并且在bootstrap.yml 中配置server-config服务的url地址，Client就能自己读取到配置中心服务的数据 pom依赖 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.2.5.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.wunanyu&lt;/groupId&gt; &lt;artifactId&gt;Eureka&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;Eureka&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;spring-cloud.version&gt;Hoxton.SR3&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--Spring Boot Actuator，感应服务端变化 监控工具，可以刷新数据（需要自己主动调用接口）--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring-cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; 配置文件 bootstrap.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 spring: application: name: eureka cloud: config: uri: http://192.168.50.135:8888 profile: dev label: master management: endpoints: web: exposure: include: - &quot;*&quot; eureka: server: renewal-percent-threshold: 0.45 log: path: log logback-spring.xml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;!-- 配置说明 %6 表示字段最小长度为6，格式右对齐 [ 右对齐 ] %-64 表示最小长度64，并且左对齐 [左对齐 ] %6.32 表示最小长度6，最大长度32 [左对齐 ] --&gt; &lt;configuration scan=&quot;true&quot; scanPeriod=&quot;60 seconds&quot; debug=&quot;false&quot;&gt; &lt;!-- 默认读取application.yml 配置 --&gt; &lt;springProperty scope=&quot;contex&quot; name=&quot;app&quot; source=&quot;spring.application.name&quot;&gt;&lt;/springProperty&gt; &lt;springProperty scope=&quot;contex&quot; name=&quot;log.path&quot; source=&quot;log.path&quot;&gt;&lt;/springProperty&gt; &lt;!-- &lt;property name=&quot;log.path&quot; value=&quot;log&quot; /&gt; --&gt; &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d -%magenta(%6(${PID:- }))- [%-5(${app})] [%6thread] %-5level %cyan(%-64logger{128}) - %msg%n&quot; /&gt; &lt;!-- 时间 进程 线程 日志级别 输出对象 消息内容 --&gt; &lt;!-- 彩色 --&gt; &lt;!-- &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d -%magenta(${PID:- })- [%16thread] %customcolor(%-5level) %cyan(%-64logger{128}) - %msg%n&quot; /&gt; --&gt; &lt;!-- 黑白日志 --&gt; &lt;!-- &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d -%6(${PID:- })- [%16thread] %-5level %-64logger{128} - %msg%n&quot; /&gt; --&gt; &lt;!-- &lt;contextName&gt;${app}&lt;/contextName&gt; --&gt; &lt;!--输出到控制台 --&gt; &lt;appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; &lt;!-- 级别过滤 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;!-- 级别低于INFO 的日志不会被打印 --&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;/filter&gt; &lt;!-- 打印模板 --&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;!-- &lt;pattern&gt;%d -%magenta(${PID:- })- [%16thread] %customcolor(%-5level) %cyan(%-64logger{128}) - %msg%n&lt;/pattern&gt; --&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!--输出到文件 --&gt; &lt;!-- all 日志文件，级别高于info 的全部打印 --&gt; &lt;appender name=&quot;all-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-all.log&lt;/file&gt; &lt;!-- ThresholdFilter级别过滤 级别大于 info 的才会输出 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/all/${app}-all-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.all-log.zip&lt;/fileNamePattern&gt; --&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- info 日志文件 只打印info级别信息 --&gt; &lt;appender name=&quot;info-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-info.log&lt;/file&gt; &lt;!-- 只打印唯一种级别的日志 可以用 LevelFilter 配置 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;!--匹配到就允许 --&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;!--没匹配到就禁止 --&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/info/${app}-info-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- warn 日志文件 只打印warn级别信息 --&gt; &lt;appender name=&quot;warn-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-warn.log&lt;/file&gt; &lt;!-- 只打印唯一种级别的日志 可以用 LevelFilter 配置 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;WARN&lt;/level&gt; &lt;!--匹配到就允许 --&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;!--没匹配到就禁止 --&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/warn/${app}-warn-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;!-- &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.warn-log.zip&lt;/fileNamePattern&gt; 日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; --&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- error 日志文件 只打印error级别信息 --&gt; &lt;appender name=&quot;error-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-error.log&lt;/file&gt; &lt;!-- &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; --&gt; &lt;!--如果只是想要 Error 级别的日志，那么需要过滤一下，默认是 info 级别的，ThresholdFilter --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;level&gt;Error&lt;/level&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/error/${app}-error-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- root 指定打印日志最低级别 --&gt; &lt;root level=&quot;info&quot;&gt; &lt;appender-ref ref=&quot;console&quot; /&gt; &lt;appender-ref ref=&quot;all-file&quot; /&gt; &lt;!-- &lt;appender-ref ref=&quot;trace-file&quot; /&gt; --&gt; &lt;!-- &lt;appender-ref ref=&quot;debug-file&quot; /&gt; --&gt; &lt;appender-ref ref=&quot;info-file&quot; /&gt; &lt;appender-ref ref=&quot;warn-file&quot; /&gt; &lt;appender-ref ref=&quot;error-file&quot; /&gt; &lt;/root&gt; &lt;!-- logback为java中的包 --&gt; &lt;!-- &lt;logger name=&quot;com.baiding&quot;/&gt; --&gt; &lt;!-- java中的包 --&gt; &lt;!-- &lt;logger name=&quot;com.baiding&quot; level=&quot;warn&quot; addtivity=&quot;false&quot;&gt; &lt;appender-ref ref=&quot;console&quot; /&gt; &lt;/logger&gt; --&gt; &lt;!-- &lt;appender name=&quot;trace-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/spring-boot-${log.name}-trace.log&lt;/file&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;TRACE&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.trace-log.zip&lt;/fileNamePattern&gt; 日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; --&gt; &lt;!-- &lt;appender name=&quot;debug-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/spring-boot-${log.name}-debug.log&lt;/file&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;DEBUG&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.debug-log.zip&lt;/fileNamePattern&gt; 日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; --&gt; &lt;/configuration&gt; 启动类 1 2 3 4 5 6 7 8 9 10 11 12 13 14 package com.wunanyu.cloud.eureka; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication public class EurekaApplication { public static void main(String[] args) { SpringApplication.run(EurekaApplication.class, args); } }" /><meta property="og:description" content="ServerConfig SpringCloud 组件，ServerConfig 是配置服务中心，组件，用于统一管理项目配置’’ 原理 读取配置文件内容到服务中心 通过启动一个springboot服务（server-config），配置好git仓库地址（也可以svn或者其他），通过配置好的文件地址，访问配置文件，将配置读取到服务中心，并且文件内容修改后，可以实时刷新。 客户端到配置中心读配置内容 其他微服务访问配置不需要访问git，只需要通过访问ServerConfig读取配置，能到达统一配置的目的。 搭建 前提概要，本搭建使用ide:Spring Tool Suite 4 Version: 4.3.0.RELEASE Build Id: 201906200901 安装好maven 3.6.3，并配置好网络通畅的maven仓库地址，有些国外仓库地址可能网速不好，下载依赖慢。 国内镜像仓库反而更快 https://www.cnblogs.com/Narule/p/12595960.html Server file -&gt; new -&gt; Spring Starter Project pom依赖 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.2.5.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.wunanyu&lt;/groupId&gt; &lt;artifactId&gt;Config&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;Config&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;spring-cloud.version&gt;Hoxton.SR3&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring-cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; 配置文件 application.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 server: port: 8888 # 服务端口号 spring: application: name: server-config #服务名 cloud: config: server: git: uri: /usr/data/git/cloud/config #linux配置文件地址 # 这里可以配置文件路径，也可以配置服务器路径，windows需要添加// # 如uri: file://${user.home}/config-repo # github uri：https：//github.com/repo # #logging: #config: src/main/resources/logback-spring.xml log: path: log #日志路径 更详细可以见https://www.cnblogs.com/hellxz/p/9306507.html logback-spring.xml 日志打印的配置文件已经配置好，可以直接用，这里不介绍logback细节，不是本次重点 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;!-- 配置说明 %6 表示字段最小长度为6，格式右对齐 [ 右对齐 ] %-64 表示最小长度64，并且左对齐 [左对齐 ] %6.32 表示最小长度6，最大长度32 [左对齐 ] --&gt; &lt;configuration scan=&quot;true&quot; scanPeriod=&quot;60 seconds&quot; debug=&quot;false&quot;&gt; &lt;!-- 默认读取application.yml 配置 --&gt; &lt;springProperty scope=&quot;contex&quot; name=&quot;app&quot; source=&quot;spring.application.name&quot;&gt;&lt;/springProperty&gt; &lt;springProperty scope=&quot;contex&quot; name=&quot;log.path&quot; source=&quot;log.path&quot;&gt;&lt;/springProperty&gt; &lt;!-- &lt;property name=&quot;log.path&quot; value=&quot;log&quot; /&gt; --&gt; &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d -%magenta(%6(${PID:- }))- [%-5(${app})] [%6thread] %-5level %cyan(%-64logger{128}) - %msg%n&quot; /&gt; &lt;!-- 时间 进程 线程 日志级别 输出对象 消息内容 --&gt; &lt;!-- 彩色 --&gt; &lt;!-- &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d -%magenta(${PID:- })- [%16thread] %customcolor(%-5level) %cyan(%-64logger{128}) - %msg%n&quot; /&gt; --&gt; &lt;!-- 黑白日志 --&gt; &lt;!-- &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d -%6(${PID:- })- [%16thread] %-5level %-64logger{128} - %msg%n&quot; /&gt; --&gt; &lt;!-- &lt;contextName&gt;${app}&lt;/contextName&gt; --&gt; &lt;!--输出到控制台 --&gt; &lt;appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; &lt;!-- 级别过滤 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;!-- 级别低于INFO 的日志不会被打印 --&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;/filter&gt; &lt;!-- 打印模板 --&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;!-- &lt;pattern&gt;%d -%magenta(${PID:- })- [%16thread] %customcolor(%-5level) %cyan(%-64logger{128}) - %msg%n&lt;/pattern&gt; --&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!--输出到文件 --&gt; &lt;!-- all 日志文件，级别高于info 的全部打印 --&gt; &lt;appender name=&quot;all-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-all.log&lt;/file&gt; &lt;!-- ThresholdFilter级别过滤 级别大于 info 的才会输出 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/all/${app}-all-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.all-log.zip&lt;/fileNamePattern&gt; --&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- info 日志文件 只打印info级别信息 --&gt; &lt;appender name=&quot;info-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-info.log&lt;/file&gt; &lt;!-- 只打印唯一种级别的日志 可以用 LevelFilter 配置 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;!--匹配到就允许 --&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;!--没匹配到就禁止 --&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/info/${app}-info-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- warn 日志文件 只打印warn级别信息 --&gt; &lt;appender name=&quot;warn-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-warn.log&lt;/file&gt; &lt;!-- 只打印唯一种级别的日志 可以用 LevelFilter 配置 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;WARN&lt;/level&gt; &lt;!--匹配到就允许 --&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;!--没匹配到就禁止 --&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/warn/${app}-warn-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;!-- &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.warn-log.zip&lt;/fileNamePattern&gt; 日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; --&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- error 日志文件 只打印error级别信息 --&gt; &lt;appender name=&quot;error-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-error.log&lt;/file&gt; &lt;!-- &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; --&gt; &lt;!--如果只是想要 Error 级别的日志，那么需要过滤一下，默认是 info 级别的，ThresholdFilter --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;level&gt;Error&lt;/level&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/error/${app}-error-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- root 指定打印日志最低级别 --&gt; &lt;root level=&quot;info&quot;&gt; &lt;appender-ref ref=&quot;console&quot; /&gt; &lt;appender-ref ref=&quot;all-file&quot; /&gt; &lt;!-- &lt;appender-ref ref=&quot;trace-file&quot; /&gt; --&gt; &lt;!-- &lt;appender-ref ref=&quot;debug-file&quot; /&gt; --&gt; &lt;appender-ref ref=&quot;info-file&quot; /&gt; &lt;appender-ref ref=&quot;warn-file&quot; /&gt; &lt;appender-ref ref=&quot;error-file&quot; /&gt; &lt;/root&gt; &lt;!-- logback为java中的包 --&gt; &lt;!-- &lt;logger name=&quot;com.baiding&quot;/&gt; --&gt; &lt;!-- java中的包 --&gt; &lt;!-- &lt;logger name=&quot;com.baiding&quot; level=&quot;warn&quot; addtivity=&quot;false&quot;&gt; &lt;appender-ref ref=&quot;console&quot; /&gt; &lt;/logger&gt; --&gt; &lt;!-- &lt;appender name=&quot;trace-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/spring-boot-${log.name}-trace.log&lt;/file&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;TRACE&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.trace-log.zip&lt;/fileNamePattern&gt; 日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; --&gt; &lt;!-- &lt;appender name=&quot;debug-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/spring-boot-${log.name}-debug.log&lt;/file&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;DEBUG&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.debug-log.zip&lt;/fileNamePattern&gt; 日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; --&gt; &lt;/configuration&gt; 启动类 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 package com.wunanyu.cloud.config; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.config.server.EnableConfigServer; @SpringBootApplication //springboot启动类注解 @EnableConfigServer //SpringCloud-ServerConfig配置中心服务注解，表示这是配置服务中心 /** * @author Narule */ public class ConfigApplication { public static void main(String[] args) { SpringApplication.run(ConfigApplication.class, args); } } 启动这个类的main方法，看控制台console的打印日志是否启动成功，启动成功，则可以通过 localhost:8888/eureka-dev.yml 查看配置信息，只要配置地址有这个文件 configserver 配置文件规则 1 2 3 4 5 / { 应用名 } / { 环境名 } [ / { 分支名 } ] / { 应用名 } - { 环境名 }.yml / { 应用名 } - { 环境名 }.properties / { 分支名 } / { 应用名 } - { 环境名 }.yml / { 分支名 } / { 应用名 } - { 环境名 }.properties client 读取配置 如果一个springboot服务叫eureka,eureka配置如下 bootstrap.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 spring: application: name: eureka #应用名 cloud: config: uri: localhost:8888 #配置中心的访问地址 这不是配置文件的地址，是配置服务server-config的地址 profile: dev #环境 label: master #分支 management: endpoints: web: exposure: include: - &quot;*&quot; eureka: server: renewal-percent-threshold: 0.45 log: path: log 那么他会读取的文件名称为eureka-dev.yml, git分支为master的文件(默认) Client Client 其实只是在pom中添加 config依赖 &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt; &lt;/dependency&gt; 并且在bootstrap.yml 中配置server-config服务的url地址，Client就能自己读取到配置中心服务的数据 pom依赖 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.2.5.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.wunanyu&lt;/groupId&gt; &lt;artifactId&gt;Eureka&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;Eureka&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;spring-cloud.version&gt;Hoxton.SR3&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--Spring Boot Actuator，感应服务端变化 监控工具，可以刷新数据（需要自己主动调用接口）--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring-cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; 配置文件 bootstrap.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 spring: application: name: eureka cloud: config: uri: http://192.168.50.135:8888 profile: dev label: master management: endpoints: web: exposure: include: - &quot;*&quot; eureka: server: renewal-percent-threshold: 0.45 log: path: log logback-spring.xml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;!-- 配置说明 %6 表示字段最小长度为6，格式右对齐 [ 右对齐 ] %-64 表示最小长度64，并且左对齐 [左对齐 ] %6.32 表示最小长度6，最大长度32 [左对齐 ] --&gt; &lt;configuration scan=&quot;true&quot; scanPeriod=&quot;60 seconds&quot; debug=&quot;false&quot;&gt; &lt;!-- 默认读取application.yml 配置 --&gt; &lt;springProperty scope=&quot;contex&quot; name=&quot;app&quot; source=&quot;spring.application.name&quot;&gt;&lt;/springProperty&gt; &lt;springProperty scope=&quot;contex&quot; name=&quot;log.path&quot; source=&quot;log.path&quot;&gt;&lt;/springProperty&gt; &lt;!-- &lt;property name=&quot;log.path&quot; value=&quot;log&quot; /&gt; --&gt; &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d -%magenta(%6(${PID:- }))- [%-5(${app})] [%6thread] %-5level %cyan(%-64logger{128}) - %msg%n&quot; /&gt; &lt;!-- 时间 进程 线程 日志级别 输出对象 消息内容 --&gt; &lt;!-- 彩色 --&gt; &lt;!-- &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d -%magenta(${PID:- })- [%16thread] %customcolor(%-5level) %cyan(%-64logger{128}) - %msg%n&quot; /&gt; --&gt; &lt;!-- 黑白日志 --&gt; &lt;!-- &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d -%6(${PID:- })- [%16thread] %-5level %-64logger{128} - %msg%n&quot; /&gt; --&gt; &lt;!-- &lt;contextName&gt;${app}&lt;/contextName&gt; --&gt; &lt;!--输出到控制台 --&gt; &lt;appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; &lt;!-- 级别过滤 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;!-- 级别低于INFO 的日志不会被打印 --&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;/filter&gt; &lt;!-- 打印模板 --&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;!-- &lt;pattern&gt;%d -%magenta(${PID:- })- [%16thread] %customcolor(%-5level) %cyan(%-64logger{128}) - %msg%n&lt;/pattern&gt; --&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!--输出到文件 --&gt; &lt;!-- all 日志文件，级别高于info 的全部打印 --&gt; &lt;appender name=&quot;all-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-all.log&lt;/file&gt; &lt;!-- ThresholdFilter级别过滤 级别大于 info 的才会输出 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/all/${app}-all-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.all-log.zip&lt;/fileNamePattern&gt; --&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- info 日志文件 只打印info级别信息 --&gt; &lt;appender name=&quot;info-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-info.log&lt;/file&gt; &lt;!-- 只打印唯一种级别的日志 可以用 LevelFilter 配置 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;!--匹配到就允许 --&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;!--没匹配到就禁止 --&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/info/${app}-info-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- warn 日志文件 只打印warn级别信息 --&gt; &lt;appender name=&quot;warn-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-warn.log&lt;/file&gt; &lt;!-- 只打印唯一种级别的日志 可以用 LevelFilter 配置 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;WARN&lt;/level&gt; &lt;!--匹配到就允许 --&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;!--没匹配到就禁止 --&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/warn/${app}-warn-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;!-- &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.warn-log.zip&lt;/fileNamePattern&gt; 日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; --&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- error 日志文件 只打印error级别信息 --&gt; &lt;appender name=&quot;error-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-error.log&lt;/file&gt; &lt;!-- &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; --&gt; &lt;!--如果只是想要 Error 级别的日志，那么需要过滤一下，默认是 info 级别的，ThresholdFilter --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;level&gt;Error&lt;/level&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/error/${app}-error-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- root 指定打印日志最低级别 --&gt; &lt;root level=&quot;info&quot;&gt; &lt;appender-ref ref=&quot;console&quot; /&gt; &lt;appender-ref ref=&quot;all-file&quot; /&gt; &lt;!-- &lt;appender-ref ref=&quot;trace-file&quot; /&gt; --&gt; &lt;!-- &lt;appender-ref ref=&quot;debug-file&quot; /&gt; --&gt; &lt;appender-ref ref=&quot;info-file&quot; /&gt; &lt;appender-ref ref=&quot;warn-file&quot; /&gt; &lt;appender-ref ref=&quot;error-file&quot; /&gt; &lt;/root&gt; &lt;!-- logback为java中的包 --&gt; &lt;!-- &lt;logger name=&quot;com.baiding&quot;/&gt; --&gt; &lt;!-- java中的包 --&gt; &lt;!-- &lt;logger name=&quot;com.baiding&quot; level=&quot;warn&quot; addtivity=&quot;false&quot;&gt; &lt;appender-ref ref=&quot;console&quot; /&gt; &lt;/logger&gt; --&gt; &lt;!-- &lt;appender name=&quot;trace-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/spring-boot-${log.name}-trace.log&lt;/file&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;TRACE&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.trace-log.zip&lt;/fileNamePattern&gt; 日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; --&gt; &lt;!-- &lt;appender name=&quot;debug-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/spring-boot-${log.name}-debug.log&lt;/file&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;DEBUG&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.debug-log.zip&lt;/fileNamePattern&gt; 日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; --&gt; &lt;/configuration&gt; 启动类 1 2 3 4 5 6 7 8 9 10 11 12 13 14 package com.wunanyu.cloud.eureka; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication public class EurekaApplication { public static void main(String[] args) { SpringApplication.run(EurekaApplication.class, args); } }" /><link rel="canonical" href="https://narule.github.io/posts/SpringCloud-ServerConfig/" /><meta property="og:url" content="https://narule.github.io/posts/SpringCloud-ServerConfig/" /><meta property="og:site_name" content="Narule" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-04-23T20:10:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="SpringCloud-ServerConfig" /><meta name="twitter:site" content="@no_twitter" /><meta name="twitter:creator" content="@Narule" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"ServerConfig SpringCloud 组件，ServerConfig 是配置服务中心，组件，用于统一管理项目配置’’ 原理 读取配置文件内容到服务中心 通过启动一个springboot服务（server-config），配置好git仓库地址（也可以svn或者其他），通过配置好的文件地址，访问配置文件，将配置读取到服务中心，并且文件内容修改后，可以实时刷新。 客户端到配置中心读配置内容 其他微服务访问配置不需要访问git，只需要通过访问ServerConfig读取配置，能到达统一配置的目的。 搭建 前提概要，本搭建使用ide:Spring Tool Suite 4 Version: 4.3.0.RELEASE Build Id: 201906200901 安装好maven 3.6.3，并配置好网络通畅的maven仓库地址，有些国外仓库地址可能网速不好，下载依赖慢。 国内镜像仓库反而更快 https://www.cnblogs.com/Narule/p/12595960.html Server file -&gt; new -&gt; Spring Starter Project pom依赖 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.2.5.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.wunanyu&lt;/groupId&gt; &lt;artifactId&gt;Config&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;Config&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;spring-cloud.version&gt;Hoxton.SR3&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring-cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; 配置文件 application.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 server: port: 8888 # 服务端口号 spring: application: name: server-config #服务名 cloud: config: server: git: uri: /usr/data/git/cloud/config #linux配置文件地址 # 这里可以配置文件路径，也可以配置服务器路径，windows需要添加// # 如uri: file://${user.home}/config-repo # github uri：https：//github.com/repo # #logging: #config: src/main/resources/logback-spring.xml log: path: log #日志路径 更详细可以见https://www.cnblogs.com/hellxz/p/9306507.html logback-spring.xml 日志打印的配置文件已经配置好，可以直接用，这里不介绍logback细节，不是本次重点 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;!-- 配置说明 %6 表示字段最小长度为6，格式右对齐 [ 右对齐 ] %-64 表示最小长度64，并且左对齐 [左对齐 ] %6.32 表示最小长度6，最大长度32 [左对齐 ] --&gt; &lt;configuration scan=&quot;true&quot; scanPeriod=&quot;60 seconds&quot; debug=&quot;false&quot;&gt; &lt;!-- 默认读取application.yml 配置 --&gt; &lt;springProperty scope=&quot;contex&quot; name=&quot;app&quot; source=&quot;spring.application.name&quot;&gt;&lt;/springProperty&gt; &lt;springProperty scope=&quot;contex&quot; name=&quot;log.path&quot; source=&quot;log.path&quot;&gt;&lt;/springProperty&gt; &lt;!-- &lt;property name=&quot;log.path&quot; value=&quot;log&quot; /&gt; --&gt; &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d -%magenta(%6(${PID:- }))- [%-5(${app})] [%6thread] %-5level %cyan(%-64logger{128}) - %msg%n&quot; /&gt; &lt;!-- 时间 进程 线程 日志级别 输出对象 消息内容 --&gt; &lt;!-- 彩色 --&gt; &lt;!-- &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d -%magenta(${PID:- })- [%16thread] %customcolor(%-5level) %cyan(%-64logger{128}) - %msg%n&quot; /&gt; --&gt; &lt;!-- 黑白日志 --&gt; &lt;!-- &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d -%6(${PID:- })- [%16thread] %-5level %-64logger{128} - %msg%n&quot; /&gt; --&gt; &lt;!-- &lt;contextName&gt;${app}&lt;/contextName&gt; --&gt; &lt;!--输出到控制台 --&gt; &lt;appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; &lt;!-- 级别过滤 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;!-- 级别低于INFO 的日志不会被打印 --&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;/filter&gt; &lt;!-- 打印模板 --&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;!-- &lt;pattern&gt;%d -%magenta(${PID:- })- [%16thread] %customcolor(%-5level) %cyan(%-64logger{128}) - %msg%n&lt;/pattern&gt; --&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!--输出到文件 --&gt; &lt;!-- all 日志文件，级别高于info 的全部打印 --&gt; &lt;appender name=&quot;all-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-all.log&lt;/file&gt; &lt;!-- ThresholdFilter级别过滤 级别大于 info 的才会输出 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/all/${app}-all-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.all-log.zip&lt;/fileNamePattern&gt; --&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- info 日志文件 只打印info级别信息 --&gt; &lt;appender name=&quot;info-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-info.log&lt;/file&gt; &lt;!-- 只打印唯一种级别的日志 可以用 LevelFilter 配置 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;!--匹配到就允许 --&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;!--没匹配到就禁止 --&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/info/${app}-info-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- warn 日志文件 只打印warn级别信息 --&gt; &lt;appender name=&quot;warn-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-warn.log&lt;/file&gt; &lt;!-- 只打印唯一种级别的日志 可以用 LevelFilter 配置 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;WARN&lt;/level&gt; &lt;!--匹配到就允许 --&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;!--没匹配到就禁止 --&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/warn/${app}-warn-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;!-- &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.warn-log.zip&lt;/fileNamePattern&gt; 日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; --&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- error 日志文件 只打印error级别信息 --&gt; &lt;appender name=&quot;error-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-error.log&lt;/file&gt; &lt;!-- &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; --&gt; &lt;!--如果只是想要 Error 级别的日志，那么需要过滤一下，默认是 info 级别的，ThresholdFilter --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;level&gt;Error&lt;/level&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/error/${app}-error-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- root 指定打印日志最低级别 --&gt; &lt;root level=&quot;info&quot;&gt; &lt;appender-ref ref=&quot;console&quot; /&gt; &lt;appender-ref ref=&quot;all-file&quot; /&gt; &lt;!-- &lt;appender-ref ref=&quot;trace-file&quot; /&gt; --&gt; &lt;!-- &lt;appender-ref ref=&quot;debug-file&quot; /&gt; --&gt; &lt;appender-ref ref=&quot;info-file&quot; /&gt; &lt;appender-ref ref=&quot;warn-file&quot; /&gt; &lt;appender-ref ref=&quot;error-file&quot; /&gt; &lt;/root&gt; &lt;!-- logback为java中的包 --&gt; &lt;!-- &lt;logger name=&quot;com.baiding&quot;/&gt; --&gt; &lt;!-- java中的包 --&gt; &lt;!-- &lt;logger name=&quot;com.baiding&quot; level=&quot;warn&quot; addtivity=&quot;false&quot;&gt; &lt;appender-ref ref=&quot;console&quot; /&gt; &lt;/logger&gt; --&gt; &lt;!-- &lt;appender name=&quot;trace-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/spring-boot-${log.name}-trace.log&lt;/file&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;TRACE&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.trace-log.zip&lt;/fileNamePattern&gt; 日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; --&gt; &lt;!-- &lt;appender name=&quot;debug-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/spring-boot-${log.name}-debug.log&lt;/file&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;DEBUG&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.debug-log.zip&lt;/fileNamePattern&gt; 日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; --&gt; &lt;/configuration&gt; 启动类 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 package com.wunanyu.cloud.config; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.config.server.EnableConfigServer; @SpringBootApplication //springboot启动类注解 @EnableConfigServer //SpringCloud-ServerConfig配置中心服务注解，表示这是配置服务中心 /** * @author Narule */ public class ConfigApplication { public static void main(String[] args) { SpringApplication.run(ConfigApplication.class, args); } } 启动这个类的main方法，看控制台console的打印日志是否启动成功，启动成功，则可以通过 localhost:8888/eureka-dev.yml 查看配置信息，只要配置地址有这个文件 configserver 配置文件规则 1 2 3 4 5 / { 应用名 } / { 环境名 } [ / { 分支名 } ] / { 应用名 } - { 环境名 }.yml / { 应用名 } - { 环境名 }.properties / { 分支名 } / { 应用名 } - { 环境名 }.yml / { 分支名 } / { 应用名 } - { 环境名 }.properties client 读取配置 如果一个springboot服务叫eureka,eureka配置如下 bootstrap.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 spring: application: name: eureka #应用名 cloud: config: uri: localhost:8888 #配置中心的访问地址 这不是配置文件的地址，是配置服务server-config的地址 profile: dev #环境 label: master #分支 management: endpoints: web: exposure: include: - &quot;*&quot; eureka: server: renewal-percent-threshold: 0.45 log: path: log 那么他会读取的文件名称为eureka-dev.yml, git分支为master的文件(默认) Client Client 其实只是在pom中添加 config依赖 &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt; &lt;/dependency&gt; 并且在bootstrap.yml 中配置server-config服务的url地址，Client就能自己读取到配置中心服务的数据 pom依赖 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.2.5.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.wunanyu&lt;/groupId&gt; &lt;artifactId&gt;Eureka&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;Eureka&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;spring-cloud.version&gt;Hoxton.SR3&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--Spring Boot Actuator，感应服务端变化 监控工具，可以刷新数据（需要自己主动调用接口）--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring-cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; 配置文件 bootstrap.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 spring: application: name: eureka cloud: config: uri: http://192.168.50.135:8888 profile: dev label: master management: endpoints: web: exposure: include: - &quot;*&quot; eureka: server: renewal-percent-threshold: 0.45 log: path: log logback-spring.xml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;!-- 配置说明 %6 表示字段最小长度为6，格式右对齐 [ 右对齐 ] %-64 表示最小长度64，并且左对齐 [左对齐 ] %6.32 表示最小长度6，最大长度32 [左对齐 ] --&gt; &lt;configuration scan=&quot;true&quot; scanPeriod=&quot;60 seconds&quot; debug=&quot;false&quot;&gt; &lt;!-- 默认读取application.yml 配置 --&gt; &lt;springProperty scope=&quot;contex&quot; name=&quot;app&quot; source=&quot;spring.application.name&quot;&gt;&lt;/springProperty&gt; &lt;springProperty scope=&quot;contex&quot; name=&quot;log.path&quot; source=&quot;log.path&quot;&gt;&lt;/springProperty&gt; &lt;!-- &lt;property name=&quot;log.path&quot; value=&quot;log&quot; /&gt; --&gt; &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d -%magenta(%6(${PID:- }))- [%-5(${app})] [%6thread] %-5level %cyan(%-64logger{128}) - %msg%n&quot; /&gt; &lt;!-- 时间 进程 线程 日志级别 输出对象 消息内容 --&gt; &lt;!-- 彩色 --&gt; &lt;!-- &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d -%magenta(${PID:- })- [%16thread] %customcolor(%-5level) %cyan(%-64logger{128}) - %msg%n&quot; /&gt; --&gt; &lt;!-- 黑白日志 --&gt; &lt;!-- &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d -%6(${PID:- })- [%16thread] %-5level %-64logger{128} - %msg%n&quot; /&gt; --&gt; &lt;!-- &lt;contextName&gt;${app}&lt;/contextName&gt; --&gt; &lt;!--输出到控制台 --&gt; &lt;appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; &lt;!-- 级别过滤 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;!-- 级别低于INFO 的日志不会被打印 --&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;/filter&gt; &lt;!-- 打印模板 --&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;!-- &lt;pattern&gt;%d -%magenta(${PID:- })- [%16thread] %customcolor(%-5level) %cyan(%-64logger{128}) - %msg%n&lt;/pattern&gt; --&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!--输出到文件 --&gt; &lt;!-- all 日志文件，级别高于info 的全部打印 --&gt; &lt;appender name=&quot;all-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-all.log&lt;/file&gt; &lt;!-- ThresholdFilter级别过滤 级别大于 info 的才会输出 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/all/${app}-all-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.all-log.zip&lt;/fileNamePattern&gt; --&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- info 日志文件 只打印info级别信息 --&gt; &lt;appender name=&quot;info-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-info.log&lt;/file&gt; &lt;!-- 只打印唯一种级别的日志 可以用 LevelFilter 配置 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;!--匹配到就允许 --&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;!--没匹配到就禁止 --&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/info/${app}-info-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- warn 日志文件 只打印warn级别信息 --&gt; &lt;appender name=&quot;warn-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-warn.log&lt;/file&gt; &lt;!-- 只打印唯一种级别的日志 可以用 LevelFilter 配置 --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;WARN&lt;/level&gt; &lt;!--匹配到就允许 --&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;!--没匹配到就禁止 --&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/warn/${app}-warn-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;!-- &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.warn-log.zip&lt;/fileNamePattern&gt; 日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; --&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- error 日志文件 只打印error级别信息 --&gt; &lt;appender name=&quot;error-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/${app}-error.log&lt;/file&gt; &lt;!-- &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; --&gt; &lt;!--如果只是想要 Error 级别的日志，那么需要过滤一下，默认是 info 级别的，ThresholdFilter --&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;level&gt;Error&lt;/level&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/error/${app}-error-logging-%d{yyyy-MM-dd}.log &lt;/fileNamePattern&gt; &lt;!-- 日志保存周期 --&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;!-- 总大小 --&gt; &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- root 指定打印日志最低级别 --&gt; &lt;root level=&quot;info&quot;&gt; &lt;appender-ref ref=&quot;console&quot; /&gt; &lt;appender-ref ref=&quot;all-file&quot; /&gt; &lt;!-- &lt;appender-ref ref=&quot;trace-file&quot; /&gt; --&gt; &lt;!-- &lt;appender-ref ref=&quot;debug-file&quot; /&gt; --&gt; &lt;appender-ref ref=&quot;info-file&quot; /&gt; &lt;appender-ref ref=&quot;warn-file&quot; /&gt; &lt;appender-ref ref=&quot;error-file&quot; /&gt; &lt;/root&gt; &lt;!-- logback为java中的包 --&gt; &lt;!-- &lt;logger name=&quot;com.baiding&quot;/&gt; --&gt; &lt;!-- java中的包 --&gt; &lt;!-- &lt;logger name=&quot;com.baiding&quot; level=&quot;warn&quot; addtivity=&quot;false&quot;&gt; &lt;appender-ref ref=&quot;console&quot; /&gt; &lt;/logger&gt; --&gt; &lt;!-- &lt;appender name=&quot;trace-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/spring-boot-${log.name}-trace.log&lt;/file&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;TRACE&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.trace-log.zip&lt;/fileNamePattern&gt; 日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; --&gt; &lt;!-- &lt;appender name=&quot;debug-file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;${log.path}/spring-boot-${log.name}-debug.log&lt;/file&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;DEBUG&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.debug-log.zip&lt;/fileNamePattern&gt; 日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; --&gt; &lt;/configuration&gt; 启动类 1 2 3 4 5 6 7 8 9 10 11 12 13 14 package com.wunanyu.cloud.eureka; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication public class EurekaApplication { public static void main(String[] args) { SpringApplication.run(EurekaApplication.class, args); } }","headline":"SpringCloud-ServerConfig","dateModified":"2021-01-17T03:14:56+08:00","datePublished":"2020-04-23T20:10:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://narule.github.io/posts/SpringCloud-ServerConfig/"},"url":"https://narule.github.io/posts/SpringCloud-ServerConfig/","author":{"@type":"Person","name":"Narule"},"@type":"BlogPosting","@context":"https://schema.org"}</script><title>SpringCloud-ServerConfig | Narule</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-JVHJ82NYZT"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-JVHJ82NYZT'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://narule.github.io/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Narule</a></div><div class="site-subtitle font-italic">A Blog for Article; Chinese Blog is www.cnblogs.com/narule</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/narule" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/no_twitter" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['narule','163.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>SpringCloud-ServerConfig</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>SpringCloud-ServerConfig</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Apr 23, 2020, 8:10 PM +0800" > Apr 23, 2020 <i class="unloaded">2020-04-23T20:10:00+08:00</i> </span> by <span class="author"> Narule </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Jan 17, 2021, 3:14 AM +0800" > Jan 17, 2021 <i class="unloaded">2021-01-17T03:14:56+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3006 words">16 min</span></div></div><div class="post-content"><p>ServerConfig</p><blockquote><p>SpringCloud 组件，ServerConfig 是配置服务中心，组件，用于统一管理项目配置’’</p></blockquote><h2 id="原理">原理</h2><h3 id="读取配置文件内容到服务中心">读取配置文件内容到服务中心</h3><p>通过启动一个springboot服务（server-config），配置好git仓库地址（也可以svn或者其他），通过配置好的文件地址，访问配置文件，将配置读取到服务中心，并且文件内容修改后，可以实时刷新。</p><h3 id="客户端到配置中心读配置内容">客户端到配置中心读配置内容</h3><p>其他微服务访问配置不需要访问git，只需要通过访问ServerConfig读取配置，能到达统一配置的目的。</p><h2 id="搭建">搭建</h2><blockquote><p>前提概要，本搭建使用ide:Spring Tool Suite 4</p><p>Version: 4.3.0.RELEASE Build Id: 201906200901</p><p>安装好maven 3.6.3，并配置好网络通畅的maven仓库地址，有些国外仓库地址可能网速不好，下载依赖慢。</p><p>国内镜像仓库反而更快 https://www.cnblogs.com/Narule/p/12595960.html</p></blockquote><h2 id="server">Server</h2><p>file -&gt; new -&gt; Spring Starter Project <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://img2020.cnblogs.com/blog/1436620/202003/1436620-20200330000626226-533036850.png" alt="" /></p><h3 id="pom依赖">pom依赖</h3><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
	<span class="nt">&lt;parent&gt;</span>
		<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
		<span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
		<span class="nt">&lt;version&gt;</span>2.2.5.RELEASE<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;relativePath/&gt;</span> <span class="c">&lt;!-- lookup parent from repository --&gt;</span>
	<span class="nt">&lt;/parent&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>com.wunanyu<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>Config<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
	<span class="nt">&lt;name&gt;</span>Config<span class="nt">&lt;/name&gt;</span>
	<span class="nt">&lt;description&gt;</span>Demo project for Spring Boot<span class="nt">&lt;/description&gt;</span>

	<span class="nt">&lt;properties&gt;</span>
		<span class="nt">&lt;java.version&gt;</span>1.8<span class="nt">&lt;/java.version&gt;</span>
		<span class="nt">&lt;spring-cloud.version&gt;</span>Hoxton.SR3<span class="nt">&lt;/spring-cloud.version&gt;</span>
	<span class="nt">&lt;/properties&gt;</span>

	<span class="nt">&lt;dependencies&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-cloud-config-server<span class="nt">&lt;/artifactId&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
			<span class="nt">&lt;exclusions&gt;</span>
				<span class="nt">&lt;exclusion&gt;</span>
					<span class="nt">&lt;groupId&gt;</span>org.junit.vintage<span class="nt">&lt;/groupId&gt;</span>
					<span class="nt">&lt;artifactId&gt;</span>junit-vintage-engine<span class="nt">&lt;/artifactId&gt;</span>
				<span class="nt">&lt;/exclusion&gt;</span>
			<span class="nt">&lt;/exclusions&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
	<span class="nt">&lt;/dependencies&gt;</span>

	<span class="nt">&lt;dependencyManagement&gt;</span>
		<span class="nt">&lt;dependencies&gt;</span>
			<span class="nt">&lt;dependency&gt;</span>
				<span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
				<span class="nt">&lt;artifactId&gt;</span>spring-cloud-dependencies<span class="nt">&lt;/artifactId&gt;</span>
				<span class="nt">&lt;version&gt;</span>${spring-cloud.version}<span class="nt">&lt;/version&gt;</span>
				<span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
				<span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
			<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;/dependencies&gt;</span>
	<span class="nt">&lt;/dependencyManagement&gt;</span>

	<span class="nt">&lt;build&gt;</span>
		<span class="nt">&lt;plugins&gt;</span>
			<span class="nt">&lt;plugin&gt;</span>
				<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
				<span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;/plugin&gt;</span>
		<span class="nt">&lt;/plugins&gt;</span>
	<span class="nt">&lt;/build&gt;</span>

<span class="nt">&lt;/project&gt;</span>

</pre></table></code></div></div><h3 id="配置文件">配置文件</h3><h4 id="applicationyml">application.yml</h4><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">8888</span>  <span class="c1">#	服务端口号</span>
<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">server-config</span>  <span class="c1">#服务名</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">config</span><span class="pi">:</span>
      <span class="na">server</span><span class="pi">:</span>
        <span class="na">git</span><span class="pi">:</span>
          <span class="na">uri</span><span class="pi">:</span> <span class="s">/usr/data/git/cloud/config</span>  <span class="c1">#linux配置文件地址</span>
          <span class="c1"># 这里可以配置文件路径，也可以配置服务器路径，windows需要添加//  </span>
          <span class="c1"># 如uri: file://${user.home}/config-repo</span>
          <span class="c1"># github  uri：https：//github.com/repo</span>

<span class="c1">#</span>
<span class="c1">#logging:</span>
<span class="c1">#config: src/main/resources/logback-spring.xml</span>
<span class="na">log</span><span class="pi">:</span>
  <span class="na">path</span><span class="pi">:</span> <span class="s">log</span>  <span class="c1">#日志路径</span>
</pre></table></code></div></div><p>更详细可以见https://www.cnblogs.com/hellxz/p/9306507.html</p><h4 id="logback-springxml">logback-spring.xml</h4><blockquote><p>日志打印的配置文件已经配置好，可以直接用，这里不介绍logback细节，不是本次重点</p></blockquote><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c">&lt;!--  
配置说明

%6 表示字段最小长度为6，格式右对齐 		[	 右对齐 ]
%-64 表示最小长度64，并且左对齐		[左对齐	]
%6.32 表示最小长度6，最大长度32		[左对齐	]
--&gt;</span>
<span class="nt">&lt;configuration</span> <span class="na">scan=</span><span class="s">"true"</span> <span class="na">scanPeriod=</span><span class="s">"60 seconds"</span>
	<span class="na">debug=</span><span class="s">"false"</span><span class="nt">&gt;</span>
	<span class="c">&lt;!-- 默认读取application.yml 配置 --&gt;</span>
	<span class="nt">&lt;springProperty</span> <span class="na">scope=</span><span class="s">"contex"</span> <span class="na">name=</span><span class="s">"app"</span> <span class="na">source=</span><span class="s">"spring.application.name"</span><span class="nt">&gt;&lt;/springProperty&gt;</span>
	<span class="nt">&lt;springProperty</span> <span class="na">scope=</span><span class="s">"contex"</span> <span class="na">name=</span><span class="s">"log.path"</span> <span class="na">source=</span><span class="s">"log.path"</span><span class="nt">&gt;&lt;/springProperty&gt;</span>
 	<span class="c">&lt;!-- &lt;property name="log.path" value="log" /&gt; --&gt;</span>
	<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"LOG_PATTERN"</span>
		<span class="na">value=</span><span class="s">"%d -%magenta(%6(${PID:- }))- [%-5(${app})] [%6thread] %-5level %cyan(%-64logger{128}) - %msg%n"</span> <span class="nt">/&gt;</span>
		<span class="c">&lt;!-- 时间	进程						 线程 					日志级别 				输出对象 			消息内容 --&gt;</span>
		<span class="c">&lt;!-- 彩色 --&gt;</span>
		<span class="c">&lt;!-- &lt;property name="LOG_PATTERN" value="%d -%magenta(${PID:- })- [%16thread] %customcolor(%-5level) %cyan(%-64logger{128}) - %msg%n" /&gt; --&gt;</span>
		<span class="c">&lt;!-- 黑白日志 --&gt;</span>
		<span class="c">&lt;!-- &lt;property name="LOG_PATTERN" value="%d -%6(${PID:- })- [%16thread] %-5level %-64logger{128} - %msg%n" /&gt; --&gt;</span>
	
	<span class="c">&lt;!-- &lt;contextName&gt;${app}&lt;/contextName&gt; --&gt;</span>
	<span class="c">&lt;!--输出到控制台 --&gt;</span>
	<span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"console"</span>
		<span class="na">class=</span><span class="s">"ch.qos.logback.core.ConsoleAppender"</span><span class="nt">&gt;</span>
		<span class="c">&lt;!-- 级别过滤 --&gt;</span>
		<span class="nt">&lt;filter</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.filter.ThresholdFilter"</span><span class="nt">&gt;</span>
			<span class="c">&lt;!-- 级别低于INFO 的日志不会被打印 --&gt;</span>
			<span class="nt">&lt;level&gt;</span>INFO<span class="nt">&lt;/level&gt;</span>
		<span class="nt">&lt;/filter&gt;</span>
		<span class="c">&lt;!-- 打印模板 --&gt;</span>
		<span class="nt">&lt;encoder&gt;</span>
			<span class="nt">&lt;pattern&gt;</span>${LOG_PATTERN}<span class="nt">&lt;/pattern&gt;</span>
			<span class="c">&lt;!-- &lt;pattern&gt;%d -%magenta(${PID:- })- [%16thread] %customcolor(%-5level) 
				%cyan(%-64logger{128}) - %msg%n&lt;/pattern&gt; --&gt;</span>
		<span class="nt">&lt;/encoder&gt;</span>
	<span class="nt">&lt;/appender&gt;</span>

	<span class="c">&lt;!--输出到文件 --&gt;</span>
	<span class="c">&lt;!-- all 日志文件，级别高于info 的全部打印 --&gt;</span>
	<span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"all-file"</span>
		<span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.RollingFileAppender"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;file&gt;</span>${log.path}/${app}-all.log<span class="nt">&lt;/file&gt;</span>
		<span class="c">&lt;!-- ThresholdFilter级别过滤 级别大于 info 的才会输出 --&gt;</span>
		<span class="nt">&lt;filter</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.filter.ThresholdFilter"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;level&gt;</span>INFO<span class="nt">&lt;/level&gt;</span>
		<span class="nt">&lt;/filter&gt;</span>
		<span class="nt">&lt;rollingPolicy</span>
			<span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;fileNamePattern&gt;</span>${log.path}/all/${app}-all-logging-%d{yyyy-MM-dd}.log
			<span class="nt">&lt;/fileNamePattern&gt;</span>
			<span class="c">&lt;!-- &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.all-log.zip&lt;/fileNamePattern&gt; --&gt;</span>
			<span class="c">&lt;!-- 日志保存周期 --&gt;</span>
			<span class="nt">&lt;maxHistory&gt;</span>30<span class="nt">&lt;/maxHistory&gt;</span>
			<span class="c">&lt;!-- 总大小 --&gt;</span>
			<span class="nt">&lt;totalSizeCap&gt;</span>1GB<span class="nt">&lt;/totalSizeCap&gt;</span>
		<span class="nt">&lt;/rollingPolicy&gt;</span>
		<span class="nt">&lt;encoder&gt;</span>
			<span class="nt">&lt;pattern&gt;</span>${LOG_PATTERN}<span class="nt">&lt;/pattern&gt;</span>
		<span class="nt">&lt;/encoder&gt;</span>
	<span class="nt">&lt;/appender&gt;</span>

	<span class="c">&lt;!-- info 日志文件 只打印info级别信息 --&gt;</span>
	<span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"info-file"</span>
		<span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.RollingFileAppender"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;file&gt;</span>${log.path}/${app}-info.log<span class="nt">&lt;/file&gt;</span>
		<span class="c">&lt;!-- 只打印唯一种级别的日志 可以用 LevelFilter 配置 --&gt;</span>
		<span class="nt">&lt;filter</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.filter.LevelFilter"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;level&gt;</span>INFO<span class="nt">&lt;/level&gt;</span>
			<span class="c">&lt;!--匹配到就允许 --&gt;</span>
			<span class="nt">&lt;onMatch&gt;</span>ACCEPT<span class="nt">&lt;/onMatch&gt;</span>
			<span class="c">&lt;!--没匹配到就禁止 --&gt;</span>
			<span class="nt">&lt;onMismatch&gt;</span>DENY<span class="nt">&lt;/onMismatch&gt;</span>
		<span class="nt">&lt;/filter&gt;</span>
		<span class="nt">&lt;rollingPolicy</span>
			<span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;fileNamePattern&gt;</span>${log.path}/info/${app}-info-logging-%d{yyyy-MM-dd}.log
			<span class="nt">&lt;/fileNamePattern&gt;</span>
			<span class="c">&lt;!-- 日志保存周期 --&gt;</span>
			<span class="nt">&lt;maxHistory&gt;</span>30<span class="nt">&lt;/maxHistory&gt;</span>
			<span class="c">&lt;!-- 总大小 --&gt;</span>
			<span class="nt">&lt;totalSizeCap&gt;</span>1GB<span class="nt">&lt;/totalSizeCap&gt;</span>
		<span class="nt">&lt;/rollingPolicy&gt;</span>
		<span class="nt">&lt;encoder&gt;</span>
			<span class="nt">&lt;pattern&gt;</span>${LOG_PATTERN}<span class="nt">&lt;/pattern&gt;</span>
		<span class="nt">&lt;/encoder&gt;</span>
	<span class="nt">&lt;/appender&gt;</span>

	<span class="c">&lt;!-- warn 日志文件 只打印warn级别信息 --&gt;</span>
	<span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"warn-file"</span>
		<span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.RollingFileAppender"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;file&gt;</span>${log.path}/${app}-warn.log<span class="nt">&lt;/file&gt;</span>
		<span class="c">&lt;!-- 只打印唯一种级别的日志 可以用 LevelFilter 配置 --&gt;</span>
		<span class="nt">&lt;filter</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.filter.LevelFilter"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;level&gt;</span>WARN<span class="nt">&lt;/level&gt;</span>
			<span class="c">&lt;!--匹配到就允许 --&gt;</span>
			<span class="nt">&lt;onMatch&gt;</span>ACCEPT<span class="nt">&lt;/onMatch&gt;</span>
			<span class="c">&lt;!--没匹配到就禁止 --&gt;</span>
			<span class="nt">&lt;onMismatch&gt;</span>DENY<span class="nt">&lt;/onMismatch&gt;</span>
		<span class="nt">&lt;/filter&gt;</span>
		<span class="nt">&lt;rollingPolicy</span>
			<span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;fileNamePattern&gt;</span>${log.path}/warn/${app}-warn-logging-%d{yyyy-MM-dd}.log
			<span class="nt">&lt;/fileNamePattern&gt;</span>
			<span class="c">&lt;!-- 日志保存周期 --&gt;</span>
			<span class="nt">&lt;maxHistory&gt;</span>30<span class="nt">&lt;/maxHistory&gt;</span>
			<span class="c">&lt;!-- 总大小 --&gt;</span>
			<span class="nt">&lt;totalSizeCap&gt;</span>1GB<span class="nt">&lt;/totalSizeCap&gt;</span>
		<span class="nt">&lt;/rollingPolicy&gt;</span>
		<span class="c">&lt;!-- &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt; 
			&lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.warn-log.zip&lt;/fileNamePattern&gt; 
			日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; --&gt;</span>
		<span class="nt">&lt;encoder&gt;</span>
			<span class="nt">&lt;pattern&gt;</span>${LOG_PATTERN}<span class="nt">&lt;/pattern&gt;</span>
		<span class="nt">&lt;/encoder&gt;</span>
	<span class="nt">&lt;/appender&gt;</span>

	<span class="c">&lt;!-- error 日志文件 只打印error级别信息 --&gt;</span>
	<span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"error-file"</span>
		<span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.RollingFileAppender"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;file&gt;</span>${log.path}/${app}-error.log<span class="nt">&lt;/file&gt;</span>
		<span class="c">&lt;!-- &lt;filter class="ch.qos.logback.classic.filter.LevelFilter"&gt; &lt;level&gt;ERROR&lt;/level&gt; 
			&lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; --&gt;</span>
		<span class="c">&lt;!--如果只是想要 Error 级别的日志，那么需要过滤一下，默认是 info 级别的，ThresholdFilter --&gt;</span>
		<span class="nt">&lt;filter</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.filter.ThresholdFilter"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;level&gt;</span>Error<span class="nt">&lt;/level&gt;</span>
		<span class="nt">&lt;/filter&gt;</span>
		<span class="nt">&lt;rollingPolicy</span>
			<span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;fileNamePattern&gt;</span>${log.path}/error/${app}-error-logging-%d{yyyy-MM-dd}.log
			<span class="nt">&lt;/fileNamePattern&gt;</span>
			<span class="c">&lt;!-- 日志保存周期 --&gt;</span>
			<span class="nt">&lt;maxHistory&gt;</span>30<span class="nt">&lt;/maxHistory&gt;</span>
			<span class="c">&lt;!-- 总大小 --&gt;</span>
			<span class="nt">&lt;totalSizeCap&gt;</span>1GB<span class="nt">&lt;/totalSizeCap&gt;</span>
		<span class="nt">&lt;/rollingPolicy&gt;</span>
		<span class="nt">&lt;encoder&gt;</span>
			<span class="nt">&lt;pattern&gt;</span>${LOG_PATTERN}<span class="nt">&lt;/pattern&gt;</span>
		<span class="nt">&lt;/encoder&gt;</span>
	<span class="nt">&lt;/appender&gt;</span>






	<span class="c">&lt;!-- root 指定打印日志最低级别 --&gt;</span>
	<span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">"info"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"console"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"all-file"</span> <span class="nt">/&gt;</span>
		<span class="c">&lt;!-- &lt;appender-ref ref="trace-file" /&gt; --&gt;</span>
		<span class="c">&lt;!-- &lt;appender-ref ref="debug-file" /&gt; --&gt;</span>
		<span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"info-file"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"warn-file"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"error-file"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/root&gt;</span>

	<span class="c">&lt;!-- logback为java中的包 --&gt;</span>
	<span class="c">&lt;!-- &lt;logger name="com.baiding"/&gt; --&gt;</span>
	<span class="c">&lt;!-- java中的包 --&gt;</span>
	<span class="c">&lt;!-- &lt;logger name="com.baiding" level="warn" addtivity="false"&gt; &lt;appender-ref 
		ref="console" /&gt; &lt;/logger&gt; --&gt;</span>


	<span class="c">&lt;!-- &lt;appender name="trace-file" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt; 
		&lt;file&gt;${log.path}/spring-boot-${log.name}-trace.log&lt;/file&gt; &lt;filter class="ch.qos.logback.classic.filter.LevelFilter"&gt; 
		&lt;level&gt;TRACE&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; 
		&lt;/filter&gt; &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt; 
		&lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.trace-log.zip&lt;/fileNamePattern&gt; 
		日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; 
		&lt;encoder&gt; &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} 
		- %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; --&gt;</span>

	<span class="c">&lt;!-- &lt;appender name="debug-file" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt; 
		&lt;file&gt;${log.path}/spring-boot-${log.name}-debug.log&lt;/file&gt; &lt;filter class="ch.qos.logback.classic.filter.LevelFilter"&gt; 
		&lt;level&gt;DEBUG&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; 
		&lt;/filter&gt; &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt; 
		&lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.debug-log.zip&lt;/fileNamePattern&gt; 
		日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; 
		&lt;encoder&gt; &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} 
		- %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; --&gt;</span>

<span class="nt">&lt;/configuration&gt;</span>
</pre></table></code></div></div><h3 id="启动类">启动类</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.wunanyu.cloud.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cloud.config.server.EnableConfigServer</span><span class="o">;</span>

<span class="nd">@SpringBootApplication</span>  <span class="c1">//springboot启动类注解</span>
<span class="nd">@EnableConfigServer</span>  <span class="c1">//SpringCloud-ServerConfig配置中心服务注解，表示这是配置服务中心</span>
<span class="cm">/**
 * @author Narule
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConfigApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">ConfigApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>
	
<span class="o">}</span>
</pre></table></code></div></div><p>启动这个类的main方法，看控制台console的打印日志是否启动成功，启动成功，则可以通过</p><p>localhost:8888/eureka-dev.yml 查看配置信息，只要配置地址有这个文件</p><h3 id="configserver-配置文件规则">configserver 配置文件规则</h3><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>/ { 应用名 } / { 环境名 } [ / { 分支名 } ]
/ { 应用名 } - { 环境名 }.yml
/ { 应用名 } - { 环境名 }.properties
/ { 分支名 } / { 应用名 } - { 环境名 }.yml
/ { 分支名 } / { 应用名 } - { 环境名 }.properties
</pre></table></code></div></div><h3 id="client-读取配置">client 读取配置</h3><p>如果一个springboot服务叫eureka,eureka配置如下</p><p>bootstrap.yml</p><div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">eureka</span> <span class="c1">#应用名</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">config</span><span class="pi">:</span>
     <span class="na">uri</span><span class="pi">:</span> <span class="s">localhost:8888</span> <span class="c1">#配置中心的访问地址 这不是配置文件的地址，是配置服务server-config的地址</span>
     <span class="na">profile</span><span class="pi">:</span> <span class="s">dev</span> <span class="c1">#环境</span>
     <span class="na">label</span><span class="pi">:</span> <span class="s">master</span> <span class="c1">#分支</span>
<span class="na">management</span><span class="pi">:</span>
  <span class="na">endpoints</span><span class="pi">:</span>
    <span class="na">web</span><span class="pi">:</span>
      <span class="na">exposure</span><span class="pi">:</span>
        <span class="na">include</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">*"</span>
        
<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">server</span><span class="pi">:</span>
    <span class="na">renewal-percent-threshold</span><span class="pi">:</span> <span class="m">0.45</span>
    
<span class="na">log</span><span class="pi">:</span>
  <span class="na">path</span><span class="pi">:</span> <span class="s">log</span>
</pre></table></code></div></div><p>那么他会读取的文件名称为<code class="language-plaintext highlighter-rouge">eureka-dev.yml</code>, git分支为master的文件(默认)</p><h2 id="client">Client</h2><p>Client 其实只是在pom中添加 config依赖</p><p><code class="language-plaintext highlighter-rouge">&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt; &lt;/dependency&gt;</code></p><p>并且在bootstrap.yml 中配置server-config服务的url地址，Client就能自己读取到配置中心服务的数据</p><h3 id="pom依赖-1">pom依赖</h3><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
	<span class="nt">&lt;parent&gt;</span>
		<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
		<span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
		<span class="nt">&lt;version&gt;</span>2.2.5.RELEASE<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;relativePath/&gt;</span> <span class="c">&lt;!-- lookup parent from repository --&gt;</span>
	<span class="nt">&lt;/parent&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>com.wunanyu<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>Eureka<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
	<span class="nt">&lt;name&gt;</span>Eureka<span class="nt">&lt;/name&gt;</span>
	<span class="nt">&lt;description&gt;</span>Demo project for Spring Boot<span class="nt">&lt;/description&gt;</span>

	<span class="nt">&lt;properties&gt;</span>
		<span class="nt">&lt;java.version&gt;</span>1.8<span class="nt">&lt;/java.version&gt;</span>
		<span class="nt">&lt;spring-cloud.version&gt;</span>Hoxton.SR3<span class="nt">&lt;/spring-cloud.version&gt;</span>
	<span class="nt">&lt;/properties&gt;</span>

	<span class="nt">&lt;dependencies&gt;</span>

		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
			<span class="nt">&lt;exclusions&gt;</span>
				<span class="nt">&lt;exclusion&gt;</span>
					<span class="nt">&lt;groupId&gt;</span>org.junit.vintage<span class="nt">&lt;/groupId&gt;</span>
					<span class="nt">&lt;artifactId&gt;</span>junit-vintage-engine<span class="nt">&lt;/artifactId&gt;</span>
				<span class="nt">&lt;/exclusion&gt;</span>
			<span class="nt">&lt;/exclusions&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-config<span class="nt">&lt;/artifactId&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="c">&lt;!--Spring Boot Actuator，感应服务端变化  监控工具，可以刷新数据（需要自己主动调用接口）--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
		
	<span class="nt">&lt;/dependencies&gt;</span>

	<span class="nt">&lt;dependencyManagement&gt;</span>
		<span class="nt">&lt;dependencies&gt;</span>
			<span class="nt">&lt;dependency&gt;</span>
				<span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
				<span class="nt">&lt;artifactId&gt;</span>spring-cloud-dependencies<span class="nt">&lt;/artifactId&gt;</span>
				<span class="nt">&lt;version&gt;</span>${spring-cloud.version}<span class="nt">&lt;/version&gt;</span>
				<span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
				<span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
			<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;/dependencies&gt;</span>
	<span class="nt">&lt;/dependencyManagement&gt;</span>

	<span class="nt">&lt;build&gt;</span>
		<span class="nt">&lt;plugins&gt;</span>
			<span class="nt">&lt;plugin&gt;</span>
				<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
				<span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;/plugin&gt;</span>
		<span class="nt">&lt;/plugins&gt;</span>
	<span class="nt">&lt;/build&gt;</span>

<span class="nt">&lt;/project&gt;</span>

</pre></table></code></div></div><h3 id="配置文件-1">配置文件</h3><h4 id="bootstrapyml">bootstrap.yml</h4><div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">eureka</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">config</span><span class="pi">:</span>
     <span class="na">uri</span><span class="pi">:</span> <span class="s">http://192.168.50.135:8888</span>
     <span class="na">profile</span><span class="pi">:</span> <span class="s">dev</span>
     <span class="na">label</span><span class="pi">:</span> <span class="s">master</span>
<span class="na">management</span><span class="pi">:</span>
  <span class="na">endpoints</span><span class="pi">:</span>
    <span class="na">web</span><span class="pi">:</span>
      <span class="na">exposure</span><span class="pi">:</span>
        <span class="na">include</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">*"</span>
        
<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">server</span><span class="pi">:</span>
    <span class="na">renewal-percent-threshold</span><span class="pi">:</span> <span class="m">0.45</span>
    
<span class="na">log</span><span class="pi">:</span>
  <span class="na">path</span><span class="pi">:</span> <span class="s">log</span>
</pre></table></code></div></div><h4 id="logback-springxml-1">logback-spring.xml</h4><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c">&lt;!--  
配置说明

%6 表示字段最小长度为6，格式右对齐 		[	 右对齐 ]
%-64 表示最小长度64，并且左对齐		[左对齐	]
%6.32 表示最小长度6，最大长度32		[左对齐	]
--&gt;</span>
<span class="nt">&lt;configuration</span> <span class="na">scan=</span><span class="s">"true"</span> <span class="na">scanPeriod=</span><span class="s">"60 seconds"</span>
	<span class="na">debug=</span><span class="s">"false"</span><span class="nt">&gt;</span>
	<span class="c">&lt;!-- 默认读取application.yml 配置 --&gt;</span>
	<span class="nt">&lt;springProperty</span> <span class="na">scope=</span><span class="s">"contex"</span> <span class="na">name=</span><span class="s">"app"</span> <span class="na">source=</span><span class="s">"spring.application.name"</span><span class="nt">&gt;&lt;/springProperty&gt;</span>
	<span class="nt">&lt;springProperty</span> <span class="na">scope=</span><span class="s">"contex"</span> <span class="na">name=</span><span class="s">"log.path"</span> <span class="na">source=</span><span class="s">"log.path"</span><span class="nt">&gt;&lt;/springProperty&gt;</span>
 	<span class="c">&lt;!-- &lt;property name="log.path" value="log" /&gt; --&gt;</span>
	<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"LOG_PATTERN"</span>
		<span class="na">value=</span><span class="s">"%d -%magenta(%6(${PID:- }))- [%-5(${app})] [%6thread] %-5level %cyan(%-64logger{128}) - %msg%n"</span> <span class="nt">/&gt;</span>
		<span class="c">&lt;!-- 时间	进程						 线程 					日志级别 				输出对象 			消息内容 --&gt;</span>
		<span class="c">&lt;!-- 彩色 --&gt;</span>
		<span class="c">&lt;!-- &lt;property name="LOG_PATTERN" value="%d -%magenta(${PID:- })- [%16thread] %customcolor(%-5level) %cyan(%-64logger{128}) - %msg%n" /&gt; --&gt;</span>
		<span class="c">&lt;!-- 黑白日志 --&gt;</span>
		<span class="c">&lt;!-- &lt;property name="LOG_PATTERN" value="%d -%6(${PID:- })- [%16thread] %-5level %-64logger{128} - %msg%n" /&gt; --&gt;</span>
	
	<span class="c">&lt;!-- &lt;contextName&gt;${app}&lt;/contextName&gt; --&gt;</span>
	<span class="c">&lt;!--输出到控制台 --&gt;</span>
	<span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"console"</span>
		<span class="na">class=</span><span class="s">"ch.qos.logback.core.ConsoleAppender"</span><span class="nt">&gt;</span>
		<span class="c">&lt;!-- 级别过滤 --&gt;</span>
		<span class="nt">&lt;filter</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.filter.ThresholdFilter"</span><span class="nt">&gt;</span>
			<span class="c">&lt;!-- 级别低于INFO 的日志不会被打印 --&gt;</span>
			<span class="nt">&lt;level&gt;</span>INFO<span class="nt">&lt;/level&gt;</span>
		<span class="nt">&lt;/filter&gt;</span>
		<span class="c">&lt;!-- 打印模板 --&gt;</span>
		<span class="nt">&lt;encoder&gt;</span>
			<span class="nt">&lt;pattern&gt;</span>${LOG_PATTERN}<span class="nt">&lt;/pattern&gt;</span>
			<span class="c">&lt;!-- &lt;pattern&gt;%d -%magenta(${PID:- })- [%16thread] %customcolor(%-5level) 
				%cyan(%-64logger{128}) - %msg%n&lt;/pattern&gt; --&gt;</span>
		<span class="nt">&lt;/encoder&gt;</span>
	<span class="nt">&lt;/appender&gt;</span>

	<span class="c">&lt;!--输出到文件 --&gt;</span>
	<span class="c">&lt;!-- all 日志文件，级别高于info 的全部打印 --&gt;</span>
	<span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"all-file"</span>
		<span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.RollingFileAppender"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;file&gt;</span>${log.path}/${app}-all.log<span class="nt">&lt;/file&gt;</span>
		<span class="c">&lt;!-- ThresholdFilter级别过滤 级别大于 info 的才会输出 --&gt;</span>
		<span class="nt">&lt;filter</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.filter.ThresholdFilter"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;level&gt;</span>INFO<span class="nt">&lt;/level&gt;</span>
		<span class="nt">&lt;/filter&gt;</span>
		<span class="nt">&lt;rollingPolicy</span>
			<span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;fileNamePattern&gt;</span>${log.path}/all/${app}-all-logging-%d{yyyy-MM-dd}.log
			<span class="nt">&lt;/fileNamePattern&gt;</span>
			<span class="c">&lt;!-- &lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.all-log.zip&lt;/fileNamePattern&gt; --&gt;</span>
			<span class="c">&lt;!-- 日志保存周期 --&gt;</span>
			<span class="nt">&lt;maxHistory&gt;</span>30<span class="nt">&lt;/maxHistory&gt;</span>
			<span class="c">&lt;!-- 总大小 --&gt;</span>
			<span class="nt">&lt;totalSizeCap&gt;</span>1GB<span class="nt">&lt;/totalSizeCap&gt;</span>
		<span class="nt">&lt;/rollingPolicy&gt;</span>
		<span class="nt">&lt;encoder&gt;</span>
			<span class="nt">&lt;pattern&gt;</span>${LOG_PATTERN}<span class="nt">&lt;/pattern&gt;</span>
		<span class="nt">&lt;/encoder&gt;</span>
	<span class="nt">&lt;/appender&gt;</span>

	<span class="c">&lt;!-- info 日志文件 只打印info级别信息 --&gt;</span>
	<span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"info-file"</span>
		<span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.RollingFileAppender"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;file&gt;</span>${log.path}/${app}-info.log<span class="nt">&lt;/file&gt;</span>
		<span class="c">&lt;!-- 只打印唯一种级别的日志 可以用 LevelFilter 配置 --&gt;</span>
		<span class="nt">&lt;filter</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.filter.LevelFilter"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;level&gt;</span>INFO<span class="nt">&lt;/level&gt;</span>
			<span class="c">&lt;!--匹配到就允许 --&gt;</span>
			<span class="nt">&lt;onMatch&gt;</span>ACCEPT<span class="nt">&lt;/onMatch&gt;</span>
			<span class="c">&lt;!--没匹配到就禁止 --&gt;</span>
			<span class="nt">&lt;onMismatch&gt;</span>DENY<span class="nt">&lt;/onMismatch&gt;</span>
		<span class="nt">&lt;/filter&gt;</span>
		<span class="nt">&lt;rollingPolicy</span>
			<span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;fileNamePattern&gt;</span>${log.path}/info/${app}-info-logging-%d{yyyy-MM-dd}.log
			<span class="nt">&lt;/fileNamePattern&gt;</span>
			<span class="c">&lt;!-- 日志保存周期 --&gt;</span>
			<span class="nt">&lt;maxHistory&gt;</span>30<span class="nt">&lt;/maxHistory&gt;</span>
			<span class="c">&lt;!-- 总大小 --&gt;</span>
			<span class="nt">&lt;totalSizeCap&gt;</span>1GB<span class="nt">&lt;/totalSizeCap&gt;</span>
		<span class="nt">&lt;/rollingPolicy&gt;</span>
		<span class="nt">&lt;encoder&gt;</span>
			<span class="nt">&lt;pattern&gt;</span>${LOG_PATTERN}<span class="nt">&lt;/pattern&gt;</span>
		<span class="nt">&lt;/encoder&gt;</span>
	<span class="nt">&lt;/appender&gt;</span>

	<span class="c">&lt;!-- warn 日志文件 只打印warn级别信息 --&gt;</span>
	<span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"warn-file"</span>
		<span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.RollingFileAppender"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;file&gt;</span>${log.path}/${app}-warn.log<span class="nt">&lt;/file&gt;</span>
		<span class="c">&lt;!-- 只打印唯一种级别的日志 可以用 LevelFilter 配置 --&gt;</span>
		<span class="nt">&lt;filter</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.filter.LevelFilter"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;level&gt;</span>WARN<span class="nt">&lt;/level&gt;</span>
			<span class="c">&lt;!--匹配到就允许 --&gt;</span>
			<span class="nt">&lt;onMatch&gt;</span>ACCEPT<span class="nt">&lt;/onMatch&gt;</span>
			<span class="c">&lt;!--没匹配到就禁止 --&gt;</span>
			<span class="nt">&lt;onMismatch&gt;</span>DENY<span class="nt">&lt;/onMismatch&gt;</span>
		<span class="nt">&lt;/filter&gt;</span>
		<span class="nt">&lt;rollingPolicy</span>
			<span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;fileNamePattern&gt;</span>${log.path}/warn/${app}-warn-logging-%d{yyyy-MM-dd}.log
			<span class="nt">&lt;/fileNamePattern&gt;</span>
			<span class="c">&lt;!-- 日志保存周期 --&gt;</span>
			<span class="nt">&lt;maxHistory&gt;</span>30<span class="nt">&lt;/maxHistory&gt;</span>
			<span class="c">&lt;!-- 总大小 --&gt;</span>
			<span class="nt">&lt;totalSizeCap&gt;</span>1GB<span class="nt">&lt;/totalSizeCap&gt;</span>
		<span class="nt">&lt;/rollingPolicy&gt;</span>
		<span class="c">&lt;!-- &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt; 
			&lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.warn-log.zip&lt;/fileNamePattern&gt; 
			日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; --&gt;</span>
		<span class="nt">&lt;encoder&gt;</span>
			<span class="nt">&lt;pattern&gt;</span>${LOG_PATTERN}<span class="nt">&lt;/pattern&gt;</span>
		<span class="nt">&lt;/encoder&gt;</span>
	<span class="nt">&lt;/appender&gt;</span>

	<span class="c">&lt;!-- error 日志文件 只打印error级别信息 --&gt;</span>
	<span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"error-file"</span>
		<span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.RollingFileAppender"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;file&gt;</span>${log.path}/${app}-error.log<span class="nt">&lt;/file&gt;</span>
		<span class="c">&lt;!-- &lt;filter class="ch.qos.logback.classic.filter.LevelFilter"&gt; &lt;level&gt;ERROR&lt;/level&gt; 
			&lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; --&gt;</span>
		<span class="c">&lt;!--如果只是想要 Error 级别的日志，那么需要过滤一下，默认是 info 级别的，ThresholdFilter --&gt;</span>
		<span class="nt">&lt;filter</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.filter.ThresholdFilter"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;level&gt;</span>Error<span class="nt">&lt;/level&gt;</span>
		<span class="nt">&lt;/filter&gt;</span>
		<span class="nt">&lt;rollingPolicy</span>
			<span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;fileNamePattern&gt;</span>${log.path}/error/${app}-error-logging-%d{yyyy-MM-dd}.log
			<span class="nt">&lt;/fileNamePattern&gt;</span>
			<span class="c">&lt;!-- 日志保存周期 --&gt;</span>
			<span class="nt">&lt;maxHistory&gt;</span>30<span class="nt">&lt;/maxHistory&gt;</span>
			<span class="c">&lt;!-- 总大小 --&gt;</span>
			<span class="nt">&lt;totalSizeCap&gt;</span>1GB<span class="nt">&lt;/totalSizeCap&gt;</span>
		<span class="nt">&lt;/rollingPolicy&gt;</span>
		<span class="nt">&lt;encoder&gt;</span>
			<span class="nt">&lt;pattern&gt;</span>${LOG_PATTERN}<span class="nt">&lt;/pattern&gt;</span>
		<span class="nt">&lt;/encoder&gt;</span>
	<span class="nt">&lt;/appender&gt;</span>






	<span class="c">&lt;!-- root 指定打印日志最低级别 --&gt;</span>
	<span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">"info"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"console"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"all-file"</span> <span class="nt">/&gt;</span>
		<span class="c">&lt;!-- &lt;appender-ref ref="trace-file" /&gt; --&gt;</span>
		<span class="c">&lt;!-- &lt;appender-ref ref="debug-file" /&gt; --&gt;</span>
		<span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"info-file"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"warn-file"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"error-file"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/root&gt;</span>

	<span class="c">&lt;!-- logback为java中的包 --&gt;</span>
	<span class="c">&lt;!-- &lt;logger name="com.baiding"/&gt; --&gt;</span>
	<span class="c">&lt;!-- java中的包 --&gt;</span>
	<span class="c">&lt;!-- &lt;logger name="com.baiding" level="warn" addtivity="false"&gt; &lt;appender-ref 
		ref="console" /&gt; &lt;/logger&gt; --&gt;</span>


	<span class="c">&lt;!-- &lt;appender name="trace-file" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt; 
		&lt;file&gt;${log.path}/spring-boot-${log.name}-trace.log&lt;/file&gt; &lt;filter class="ch.qos.logback.classic.filter.LevelFilter"&gt; 
		&lt;level&gt;TRACE&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; 
		&lt;/filter&gt; &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt; 
		&lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.trace-log.zip&lt;/fileNamePattern&gt; 
		日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; 
		&lt;encoder&gt; &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} 
		- %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; --&gt;</span>

	<span class="c">&lt;!-- &lt;appender name="debug-file" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt; 
		&lt;file&gt;${log.path}/spring-boot-${log.name}-debug.log&lt;/file&gt; &lt;filter class="ch.qos.logback.classic.filter.LevelFilter"&gt; 
		&lt;level&gt;DEBUG&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; 
		&lt;/filter&gt; &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt; 
		&lt;fileNamePattern&gt;${log.path}/spring-boot-${log.name}-logging.%d{yyyy-MM-dd}.debug-log.zip&lt;/fileNamePattern&gt; 
		日志保存周期 &lt;maxHistory&gt;30&lt;/maxHistory&gt; 总大小 &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt; &lt;/rollingPolicy&gt; 
		&lt;encoder&gt; &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} 
		- %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; --&gt;</span>

<span class="nt">&lt;/configuration&gt;</span>
</pre></table></code></div></div><h3 id="启动类-1">启动类</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.wunanyu.cloud.eureka</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="o">;</span>

<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EurekaApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">EurekaApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>

</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/technology-%E6%8A%80%E6%9C%AF/'>Technology^技术</a>, <a href='/categories/java/'>Java</a>, <a href='/categories/spring/'>Spring</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/writing/" class="post-tag no-text-decoration" >writing</a> <a href="/tags/java/" class="post-tag no-text-decoration" >Java</a> <a href="/tags/spring/" class="post-tag no-text-decoration" >Spring</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=SpringCloud-ServerConfig - Narule&url=https://narule.github.io/posts/SpringCloud-ServerConfig/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=SpringCloud-ServerConfig - Narule&u=https://narule.github.io/posts/SpringCloud-ServerConfig/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=SpringCloud-ServerConfig - Narule&url=https://narule.github.io/posts/SpringCloud-ServerConfig/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/%E4%BA%92%E8%81%94%E7%BD%91%E5%A4%87%E5%BF%98%E5%BD%95/">互联网备忘录</a><li><a href="/posts/%E7%94%A8%E6%88%B7%E6%8C%87%E7%BA%B9/">用户指纹</a><li><a href="/posts/%E5%85%B3%E4%BA%8Enetty/">关于netty</a><li><a href="/posts/%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%E5%8D%9A%E5%AE%A2%E7%9A%84%E8%AE%BE%E8%AE%A1-The-design-of-an-automatically-updated-blog/">The design of an automatically updated blog | 自动更新博客的设计</a><li><a href="/posts/AbstractQueuedSynchronizer%E6%8A%BD%E8%B1%A1%E7%B1%BB-%E9%98%BB%E5%A1%9E%E9%94%81/">AbstractQueuedSynchronizer抽象类-阻塞锁</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writing/">writing</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/think/">Think</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/website/">website</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/map/">map</a> <a class="post-tag" href="/tags/nginx/">nginx</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/SpringBoot-%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/"><div class="card-body"> <span class="timeago small" > Jan 8, 2021 <i class="unloaded">2021-01-08T20:10:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SpringBoot-启动流程</h3><div class="text-muted small"><p> SpringBoot-启动流程 平时开发springboot项目的时候，一个SpringBootApplication注解加一个main方法就可以启动服务器运行起来（默认tomcat），看了下源码，这里讲下认为主要的流程 主要流程如下 0.启动main方法开始 1.初始化配置：通过类加载器，（loadFactories）读取classpath下所有的spring.factories配...</p></div></div></a></div><div class="card"> <a href="/posts/SpringCloud-%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/"><div class="card-body"> <span class="timeago small" > Jan 31, 2021 <i class="unloaded">2021-01-31T22:12:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SpringCloud-常用组件介绍</h3><div class="text-muted small"><p> 分布式系统开发用于分布式环境（多个服务器不在同一个机房，同一个业务服务在多台服务器运行） Spring Cloud 是基于Springboot的分布式云服务架构，SpringCloud的设计就是为了分布式的云环境设计 下面说一些SpringCloud项目在开发中常用的几个组件 说组件之前，将一些分布式相关的概念 CAP定理 指分区容错性 服务可用性 数据一致性，分布式环境： ...</p></div></div></a></div><div class="card"> <a href="/posts/AbstractQueuedSynchronizer%E6%8A%BD%E8%B1%A1%E7%B1%BB-%E9%98%BB%E5%A1%9E%E9%94%81/"><div class="card-body"> <span class="timeago small" > Mar 20, 2021 <i class="unloaded">2021-03-20T00:10:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AbstractQueuedSynchronizer抽象类-阻塞锁</h3><div class="text-muted small"><p> AbstractQueuedSynchronizer抽象类-阻塞锁 AbstractQueuedSynchronizer是多线程情况下保证代码快有序运行的一种设计，对多线程获取锁进行了抽象， 设计中包括： 1.线程队列（阻塞的线程） 当很多线程竞争锁的时候，排队一个个获取锁，先进先出 2.线程获取锁，成功就执行后面的代码 3.线程释放锁，如果等待队列中有线程，唤醒队列中的线程 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Object/" class="btn btn-outline-primary"><p>Java Object</p></a> <a href="/posts/%E8%8B%B1%E6%96%87%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" class="btn btn-outline-primary"><p>英文字符串排序算法</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://narule.github.io/posts/SpringCloud-ServerConfig/'; this.page.identifier = '/posts/SpringCloud-ServerConfig/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://cnblogs.com/narule">narule</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/writing/">writing</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/think/">Think</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/website/">website</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/map/">map</a> <a class="post-tag" href="/tags/nginx/">nginx</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://narule.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
