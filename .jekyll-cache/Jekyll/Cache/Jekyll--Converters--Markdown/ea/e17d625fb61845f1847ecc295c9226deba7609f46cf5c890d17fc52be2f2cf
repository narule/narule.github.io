I"µ<h2 id="fail2ban-é˜²sshæš´åŠ›ç ´è§£">fail2ban é˜²sshæš´åŠ›ç ´è§£</h2>

<p>fail2ban å‡ºç°ä¸»è¦é’ˆå¯¹ æš´åŠ›è®¿é—®æœåŠ¡å™¨è€Œè®¾è®¡</p>

<p>åŸç†æ˜¯é€šè¿‡linux æœåŠ¡å™¨ä¸Šçš„è®¿é—®æ—¥å¿—ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ï¼Œè·å–è®¿é—®ä¿¡æ¯</p>

<p>å¦‚sshç™»å½•é˜²æš´åŠ›ç ´è§£ï¼Œé€šè¿‡æ­£åˆ™sshè®¿é—®æ—¥å¿—è®°å½•ï¼Œè·å–æš´åˆ©è®¿é—®ip,å®¶ip é€šè¿‡é˜²ç«å¢™éš”ç¦»ã€‚â€™</p>

<h3 id="å®‰è£…">å®‰è£…</h3>

<p>å®˜ç½‘ <a href="http://fail2ban.org" target="_blank">fail2ban</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># centos7</span>
wget <span class="s2">"https://github.com/fail2ban/fail2ban/archive/0.9.4.tar.gz"</span>
ll
<span class="nb">tar</span> <span class="nt">-zxvf</span> 0.9.4.tar.gz
<span class="nb">cd </span>fail2ban-0.9.4
python setup.py <span class="nb">install</span> <span class="c">#æ³¨æ„ï¼Œè¿™é‡Œéœ€è¦python 2.6ä»¥ä¸Š</span>
<span class="nb">cp </span>files/redhat-initd /etc/init.d/fail2ban <span class="c"># å¯åŠ¨æ–‡ä»¶æ·»åŠ åˆ°init.dç›®å½•</span>
chkconfig <span class="nt">--add</span> fail2ban <span class="c">#æ·»åŠ å¯åŠ¨è½¯é“¾æ¥</span>
</code></pre></div></div>

<h3 id="é…ç½®">é…ç½®</h3>

<p>ssh é˜²æ­¢æš´åŠ›ç™»å½•</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> /etc/fail2ban/jail.conf /etc/fail2ban/jail.local <span class="c">#æ·»åŠ æœ¬åœ°é…ç½®æ–‡ä»¶</span>
vim /etc/fail2ban/jail.local  <span class="c"># è‡ªåŠ¨ä»¥é…ç½®</span>
</code></pre></div></div>

<p>é…ç½®å†…å®¹</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ç¦æ­¢ipæ–¹å¼</span>
banaction <span class="o">=</span> firewallcmd-ipset  
banaction_allports <span class="o">=</span> firewallcmd-allports
<span class="c">#centos7é˜²ç«å¢™é»˜è®¤æ˜¯ firewalld å¦‚æœæ˜¯iptables,å°±æ”¹ä¸ºiptables  ç›®å½•ï¼šaction.d/</span>

<span class="c"># sshd é…ç½®</span>
<span class="o">[</span>sshd]
enabled <span class="o">=</span> <span class="nb">true</span>  <span class="c">#å¯åŠ¨</span>
filter <span class="o">=</span> sshd <span class="c">#è¿‡æ»¤è§„åˆ™  ç›®å½•ï¼šfilter.d/</span>
port    <span class="o">=</span> 22 <span class="c">#æ‹¦æˆªç«¯å£</span>
<span class="c">#logpath = %(sshd_log)s </span>
logpath <span class="o">=</span> /var/log/secure  <span class="c">#ç›‘æ§æ—¥å¿—</span>
backend <span class="o">=</span> %<span class="o">(</span>sshd_backend<span class="o">)</span>s 
action <span class="o">=</span> %<span class="o">(</span>action_<span class="o">)</span>s <span class="c">#å°ç¦ipçš„åŠ¨ä½œ</span>
bantime  <span class="o">=</span> 172800 <span class="c">#ipå°ç¦æ—¶é—´</span>
maxretry <span class="o">=</span> 3  <span class="c"># é˜ˆå€¼  --åŒä¸€ä¸ªipç™»å½•å¤±è´¥å¤šå°‘æ¬¡åå°ç¦ip</span>
</code></pre></div></div>

<h3 id="å¯åŠ¨">å¯åŠ¨</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fail2ban-client <span class="nt">-d</span> <span class="c">#æ£€æŸ¥ jail.local é…ç½®æ˜¯å¦æ­£ç¡®</span>
systemctl start fail2ban <span class="c">#å¯åŠ¨</span>
</code></pre></div></div>

<h3 id="æŸ¥çœ‹">æŸ¥çœ‹</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl status fail2ban <span class="c"># æŸ¥çœ‹å¯åŠ¨çŠ¶æ€ running ä¸ºæˆåŠŸ</span>
fail2ban-client status <span class="c"># æŸ¥çœ‹çŠ¶æ€</span>
fail2ban-client status sshd <span class="c">#æŸ¥çœ‹sshd çŠ¶æ€</span>
<span class="nb">tail</span> <span class="nt">-f</span> /var/log/fail2ban.log <span class="c">#æŸ¥çœ‹fail2banç›‘æ§æ—¥å¿—</span>
</code></pre></div></div>
<p><img src="https://img2020.cnblogs.com/blog/1436620/202006/1436620-20200603210007897-1628430758.png" alt="" /></p>

<p><img src="https://img2020.cnblogs.com/blog/1436620/202006/1436620-20200603210319904-1883405565.png" alt="" /></p>

<p><img src="https://img2020.cnblogs.com/blog/1436620/202006/1436620-20200603205714946-765327654.png" alt="" /></p>
:ET